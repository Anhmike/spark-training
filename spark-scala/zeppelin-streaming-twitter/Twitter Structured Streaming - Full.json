{"paragraphs":[{"text":"%md\n# 0. Add Dependencies\n\nBefore we start working with Spark and Kafka, we need to add the Spark Kafka SQL dependency to Zeppelin:\n```\norg.apache.spark:spark-sql-kafka-0-10_2.11:2.4.4 exclude: net.jpountz.lz4:lz4\nmysql:mysql-connector-java:6.0.6\n```","dateUpdated":"2020-01-30T07:45:39+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>0. Add Dependencies</h1>\n<p>Before we start working with Spark and Kafka, we need to add the Spark Kafka SQL dependency to Zeppelin:</p>\n<pre><code>org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.4 exclude: net.jpountz.lz4:lz4\nmysql:mysql-connector-java:6.0.6\n</code></pre>\n</div>"}]},"apps":[],"jobName":"paragraph_1580370152419_-671362646","id":"20180605-065056_2074008018","dateCreated":"2020-01-30T07:42:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:252","user":"anonymous","dateFinished":"2020-01-30T07:45:40+0000","dateStarted":"2020-01-30T07:45:39+0000"},{"text":"%spark.dep\nz.reset()\nz.load(\"org.apache.spark:spark-sql-kafka-0-10_2.11:2.4.4\").exclude(\"net.jpountz.lz4:lz4\")\nz.load(\"mysql:mysql-connector-java:6.0.6\")","dateUpdated":"2020-01-30T07:45:45+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580370152422_-672516892","id":"20181202-154032_825385838","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:253"},{"text":"%md\n# 1. Connect to data source\n\nFirst you need to fill a Kafka topic, for example via\n\n    s3cat.py -I1 -B10 s3://dimajix-training/data/twitter-sample/ | /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic twitter\n\nThen we connect to the raw data socket as the datasource by using the `DataStreamReader` API via `spark.readStream`. We need to specify the options `kafka.bootstrap.servers` and `subscribe` and we need to use the format `kafka` for connecting to the data source. The Kafka topic will stream Twitter data samples in raw JSON format, i.e. one JSON document per line.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>1. Connect to data source</h1>\n<p>First you need to fill a Kafka topic, for example via</p>\n<pre><code>s3cat.py -I1 -B10 s3://dimajix-training/data/twitter-sample/ | /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic twitter\n</code></pre>\n<p>Then we connect to the raw data socket as the datasource by using the <code>DataStreamReader</code> API via <code>spark.readStream</code>. We need to specify the options <code>kafka.bootstrap.servers</code> and <code>subscribe</code> and we need to use the format <code>kafka</code> for connecting to the data source. The Kafka topic will stream Twitter data samples in raw JSON format, i.e. one JSON document per line.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152425_-675210135","id":"20170218-160028_195174762","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:254"},{"text":"// Fill in the correct AWS VPC address of your master host\nval master = \"kku.training.dimajix-aws.net\"\n\n// Connect to raw text stream socket using the DataStreamReader API via spark.readStream. You need to specify the options `host`, `port` and you need to use the format `socket`\nval lines = (spark.readStream\n  .format(\"kafka\")\n  .option(\"kafka.bootstrap.servers\", master + \":9092\")\n  .option(\"subscribe\", \"twitter\")\n  .option(\"startingOffsets\", \"latest\")\n  .load())","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"master: String = kku.training.dimajix-aws.net\nlines: org.apache.spark.sql.DataFrame = [key: binary, value: binary ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1580370152428_-676364381","id":"20170218-160002_129671727","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"text":"%md\n## 1.1 Inspect Schema\n\nThe result of the load method is a `DataFrame` again, but a streaming one. This `DataFrame` again has a schema, which we can inspect with the usual method:","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{},"colWidth":12,"editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>1.1 Inspect Schema</h2>\n<p>The result of the load method is a <code>DataFrame</code> again, but a streaming one. This <code>DataFrame</code> again has a schema, which we can inspect with the usual method:</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152431_-675979632","id":"20170218-161504_128762750","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:256"},{"text":"lines.printSchema()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- key: binary (nullable = true)\n |-- value: binary (nullable = true)\n |-- topic: string (nullable = true)\n |-- partition: integer (nullable = true)\n |-- offset: long (nullable = true)\n |-- timestamp: timestamp (nullable = true)\n |-- timestampType: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1580370152435_-665206663","id":"20170218-160206_920542952","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:257"},{"text":"%md\n# 2. Inspect Data\n\nOf course we also want to inspect the data inside the DataFrame. But this time, we cannot simply invoke `show`, because normal actions do not (directly) work on streaming DataFrames. Instead we need to create a continiuous query. Later, we will see a neat trick how a streaming query can be transformed into a volatile table.\n\nIn order to create a continuous query, we need to perform the following steps\n\n1. Create a `DataStreamWriter` by using the `writeStream` method of a DataFrame\n2. Specify the output format. We use `console` in our case\n3. Specify a checkpoint location on HDFS. This is required for restarting\n4. Optionally specify a processing period\n5. Start the query\n6. For Zeppelin only: Sleep a little bit, or we miss the output","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>2. Inspect Data</h1>\n<p>Of course we also want to inspect the data inside the DataFrame. But this time, we cannot simply invoke <code>show</code>, because normal actions do not (directly) work on streaming DataFrames. Instead we need to create a continiuous query. Later, we will see a neat trick how a streaming query can be transformed into a volatile table.</p>\n<p>In order to create a continuous query, we need to perform the following steps</p>\n<ol>\n<li>Create a <code>DataStreamWriter</code> by using the <code>writeStream</code> method of a DataFrame</li>\n<li>Specify the output format. We use <code>console</code> in our case</li>\n<li>Specify a checkpoint location on HDFS. This is required for restarting</li>\n<li>Optionally specify a processing period</li>\n<li>Start the query</li>\n<li>For Zeppelin only: Sleep a little bit, or we miss the output</li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1580370152438_-666360910","id":"20170218-161603_528321172","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:258"},{"text":"import org.apache.spark.sql.streaming.ProcessingTime\n\nval query = (lines\n    .withColumn(\"value\", $\"value\".cast(\"string\"))\n    .writeStream\n    .format(\"console\")\n    .outputMode(\"append\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-print-\" + System.currentTimeMillis())\n    .start())\n    \nThread.sleep(30000)    ","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.streaming.ProcessingTime\nquery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@188b1b46\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+---+-----+-----+---------+------+---------+-------------+\n|key|value|topic|partition|offset|timestamp|timestampType|\n+---+-----+-----+---------+------+---------+-------------+\n+---+-----+-----+---------+------+---------+-------------+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   799|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   800|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        1|   801|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   802|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   803|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   804|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   805|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        1|   806|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   807|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        1|   808|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   798|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   799|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   800|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        9|   801|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   802|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        9|   803|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   804|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   805|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   806|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   807|2018-11-22 08:36:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 2\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   808|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   808|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   808|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       13|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   808|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   809|2018-11-22 08:36:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 3\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|       15|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   809|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        5|   809|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   809|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        6|   809|2018-11-22 08:36:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 4\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"delete\":{\"statu...|twitter|        1|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   809|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        4|   810|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        7|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   810|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       13|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   810|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       10|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   810|2018-11-22 08:36:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 5\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   810|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   811|2018-11-22 08:36:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 6\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   812|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        0|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   811|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   812|2018-11-22 08:36:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   811|2018-11-22 08:36:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        6|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   812|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 7\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   813|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        4|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   813|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        2|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   813|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 8\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        9|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   813|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       14|   812|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        7|   813|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       11|   812|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   812|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        5|   812|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       13|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   813|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 9\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   813|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   814|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 10\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        9|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   814|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        8|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   814|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 11\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   815|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       15|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   814|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        4|   815|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        7|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   814|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   814|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        6|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   815|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       12|   815|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 12\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|       14|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       11|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   815|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   815|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 13\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       15|   816|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       11|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   816|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 14\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        9|   817|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        4|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        7|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        3|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        6|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       10|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       12|   817|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 15\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|       15|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   816|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       13|   817|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 16\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        1|   818|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|       14|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        4|   818|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|        7|   818|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       11|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        8|   817|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        5|   817|2018-11-22 08:37:...|            0|\n|null|{\"delete\":{\"statu...|twitter|       13|   818|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   817|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n-------------------------------------------\nBatch: 17\n-------------------------------------------\n+----+--------------------+-------+---------+------+--------------------+-------------+\n| key|               value|  topic|partition|offset|           timestamp|timestampType|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n|null|{\"created_at\":\"Fr...|twitter|        3|   818|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        0|   818|2018-11-22 08:37:...|            0|\n|null|{\"created_at\":\"Fr...|twitter|        2|   818|2018-11-22 08:37:...|            0|\n+----+--------------------+-------+---------+------+--------------------+-------------+\n\n"}]},"apps":[],"jobName":"paragraph_1580370152441_-669054152","id":"20170218-160132_1015574950","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:259"},{"text":"%md\n## 2.1 Stop Query\n\nIn contrast to the RDD API, we can simply stop an individual query instead of a whole StreamingContext by simply calling the `stop` method on the query object. This makes working with streams much easier.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>2.1 Stop Query</h2>\n<p>In contrast to the RDD API, we can simply stop an individual query instead of a whole StreamingContext by simply calling the <code>stop</code> method on the query object. This makes working with streams much easier.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152444_-670208399","id":"20170218-161746_736484246","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:260"},{"text":"query.stop","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580370152446_-669438901","id":"20170218-160155_661067655","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:261"},{"text":"query.exception","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res17: Option[org.apache.spark.sql.streaming.StreamingQueryException] = None\n"}]},"apps":[],"jobName":"paragraph_1580370152449_-979931263","id":"20181122-084005_2133988311","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:262"},{"text":"%md\n# 3. Counting Hash-Tags\n\nSo we now want to create a streaming hashtag count. First we need to extract the Tweet itself from the JSON document, then we need to extract the hashtags in a similar way to the batch word traditional DataFrame word count example, i.e. we split every line into words, keep only hash-tags, group the words and count the sizes of the groups.\n\nEach query looks as follows\n\n```\n{ \"contributors\" : null,\n  \"coordinates\" : null,\n  \"created_at\" : \"Fri Jul 29 12:46:00 +0000 2016\",\n  \"entities\" : { \"hashtags\" : [  ],\n      \"symbols\" : [  ],\n      \"urls\" : [ { \"display_url\" : \"fb.me/ItnwZEhy\",\n            \"expanded_url\" : \"http://fb.me/ItnwZEhy\",\n            \"indices\" : [ 33,\n                56\n              ],\n            \"url\" : \"https://t.co/mM0if95F1K\"\n          } ],\n      \"user_mentions\" : [  ]\n    },\n  \"favorite_count\" : 0,\n  \"favorited\" : false,\n  \"filter_level\" : \"low\",\n  \"geo\" : null,\n  \"id\" : 759007065155117058,\n  \"id_str\" : \"759007065155117058\",\n  \"in_reply_to_screen_name\" : null,\n  \"in_reply_to_status_id\" : null,\n  \"in_reply_to_status_id_str\" : null,\n  \"in_reply_to_user_id\" : null,\n  \"in_reply_to_user_id_str\" : null,\n  \"is_quote_status\" : false,\n  \"lang\" : \"en\",\n  \"place\" : null,\n  \"possibly_sensitive\" : false,\n  \"retweet_count\" : 0,\n  \"retweeted\" : false,\n  \"source\" : \"<a href=\\\"http://www.facebook.com/twitter\\\" rel=\\\"nofollow\\\">Facebook</a>\",\n  \"text\" : \"I posted a new video to Facebook https://t.co/mM0if95F1K\",\n  \"timestamp_ms\" : \"1469796360659\",\n  \"truncated\" : false,\n  \"user\" : { \"contributors_enabled\" : false,\n      \"created_at\" : \"Sat Sep 08 08:28:55 +0000 2012\",\n      \"default_profile\" : false,\n      \"default_profile_image\" : false,\n      \"description\" : null,\n      \"favourites_count\" : 0,\n      \"follow_request_sent\" : null,\n      \"followers_count\" : 0,\n      \"following\" : null,\n      \"friends_count\" : 0,\n      \"geo_enabled\" : false,\n      \"id\" : 810489374,\n      \"id_str\" : \"810489374\",\n      \"is_translator\" : false,\n      \"lang\" : \"zh-tw\",\n      \"listed_count\" : 0,\n      \"location\" : null,\n      \"name\" : \"張冥閻\",\n      \"notifications\" : null,\n      \"profile_background_color\" : \"FFF04D\",\n      \"profile_background_image_url\" : \"http://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_image_url_https\" : \"https://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_tile\" : false,\n      \"profile_image_url\" : \"http://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_image_url_https\" : \"https://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_link_color\" : \"0099CC\",\n      \"profile_sidebar_border_color\" : \"FFF8AD\",\n      \"profile_sidebar_fill_color\" : \"F6FFD1\",\n      \"profile_text_color\" : \"333333\",\n      \"profile_use_background_image\" : true,\n      \"protected\" : false,\n      \"screen_name\" : \"nineemperor1\",\n      \"statuses_count\" : 9652,\n      \"time_zone\" : null,\n      \"url\" : null,\n      \"utc_offset\" : null,\n      \"verified\" : false\n    }\n}\n```\n\nIn order to extract a field from a JSON document, we can use the `get_json_object` function.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>3. Counting Hash-Tags</h1>\n<p>So we now want to create a streaming hashtag count. First we need to extract the Tweet itself from the JSON document, then we need to extract the hashtags in a similar way to the batch word traditional DataFrame word count example, i.e. we split every line into words, keep only hash-tags, group the words and count the sizes of the groups.</p>\n<p>Each query looks as follows</p>\n<pre><code>{ \"contributors\" : null,\n  \"coordinates\" : null,\n  \"created_at\" : \"Fri Jul 29 12:46:00 +0000 2016\",\n  \"entities\" : { \"hashtags\" : [  ],\n      \"symbols\" : [  ],\n      \"urls\" : [ { \"display_url\" : \"fb.me/ItnwZEhy\",\n            \"expanded_url\" : \"http://fb.me/ItnwZEhy\",\n            \"indices\" : [ 33,\n                56\n              ],\n            \"url\" : \"https://t.co/mM0if95F1K\"\n          } ],\n      \"user_mentions\" : [  ]\n    },\n  \"favorite_count\" : 0,\n  \"favorited\" : false,\n  \"filter_level\" : \"low\",\n  \"geo\" : null,\n  \"id\" : 759007065155117058,\n  \"id_str\" : \"759007065155117058\",\n  \"in_reply_to_screen_name\" : null,\n  \"in_reply_to_status_id\" : null,\n  \"in_reply_to_status_id_str\" : null,\n  \"in_reply_to_user_id\" : null,\n  \"in_reply_to_user_id_str\" : null,\n  \"is_quote_status\" : false,\n  \"lang\" : \"en\",\n  \"place\" : null,\n  \"possibly_sensitive\" : false,\n  \"retweet_count\" : 0,\n  \"retweeted\" : false,\n  \"source\" : \"&lt;a href=\\\"http://www.facebook.com/twitter\\\" rel=\\\"nofollow\\\"&gt;Facebook&lt;/a&gt;\",\n  \"text\" : \"I posted a new video to Facebook https://t.co/mM0if95F1K\",\n  \"timestamp_ms\" : \"1469796360659\",\n  \"truncated\" : false,\n  \"user\" : { \"contributors_enabled\" : false,\n      \"created_at\" : \"Sat Sep 08 08:28:55 +0000 2012\",\n      \"default_profile\" : false,\n      \"default_profile_image\" : false,\n      \"description\" : null,\n      \"favourites_count\" : 0,\n      \"follow_request_sent\" : null,\n      \"followers_count\" : 0,\n      \"following\" : null,\n      \"friends_count\" : 0,\n      \"geo_enabled\" : false,\n      \"id\" : 810489374,\n      \"id_str\" : \"810489374\",\n      \"is_translator\" : false,\n      \"lang\" : \"zh-tw\",\n      \"listed_count\" : 0,\n      \"location\" : null,\n      \"name\" : \"張冥閻\",\n      \"notifications\" : null,\n      \"profile_background_color\" : \"FFF04D\",\n      \"profile_background_image_url\" : \"http://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_image_url_https\" : \"https://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_tile\" : false,\n      \"profile_image_url\" : \"http://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_image_url_https\" : \"https://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_link_color\" : \"0099CC\",\n      \"profile_sidebar_border_color\" : \"FFF8AD\",\n      \"profile_sidebar_fill_color\" : \"F6FFD1\",\n      \"profile_text_color\" : \"333333\",\n      \"profile_use_background_image\" : true,\n      \"protected\" : false,\n      \"screen_name\" : \"nineemperor1\",\n      \"statuses_count\" : 9652,\n      \"time_zone\" : null,\n      \"url\" : null,\n      \"utc_offset\" : null,\n      \"verified\" : false\n    }\n}\n</code></pre>\n<p>In order to extract a field from a JSON document, we can use the <code>get_json_object</code> function.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152453_-981470259","id":"20170218-161837_1521722724","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:263"},{"text":"%md\n## 3.1 Extract Tweet\n\nFirst we need to extract the tweet text itself via the `get_json_object` function and store it into a new column.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.1 Extract Tweet</h2>\n<p>First we need to extract the tweet text itself via the <code>get_json_object</code> function and store it into a new column.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152455_-980700761","id":"20170220-182415_1872492795","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:264"},{"text":"import org.apache.spark.sql.types._\n\nval ts_text = lines.select(\n        $\"timestamp\",\n        (get_json_object($\"value\".cast(\"string\"), \"$.timestamp_ms\").cast(LongType) / lit(1000)).cast(TimestampType).as(\"ts\"),\n        get_json_object($\"value\".cast(\"string\"), \"$.text\").as(\"text\"),\n        get_json_object($\"value\".cast(\"string\"), \"$.entities.hashtags[*]\").as(\"hashtags\")\n    )","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\nts_text: org.apache.spark.sql.DataFrame = [timestamp: timestamp, ts: timestamp ... 2 more fields]\n"}]},"apps":[],"jobName":"paragraph_1580370152457_-983009255","id":"20170218-160238_1475524112","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:265"},{"text":"ts_text.printSchema()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- timestamp: timestamp (nullable = true)\n |-- ts: timestamp (nullable = true)\n |-- text: string (nullable = true)\n |-- hashtags: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1580370152459_-982239757","id":"20181122-084441_64874597","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:266"},{"text":"%md\n## 3.2 Extract Topics\n\nNow that we have the Tweet text itself, we extract all topics with the following approach:\n1. Split text along spaces using `split`\n2. Create multiple records from all words using `explode`\n3. Filter all hash-tags (words that start with a `#`)\n4. Filter out all empty topics (topic name only consists of hash-tag `#` itself)","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>3.2 Extract Topics</h2>\n<p>Now that we have the Tweet text itself, we extract all topics with the following approach:<br/>1. Split text along spaces using <code>split</code><br/>2. Create multiple records from all words using <code>explode</code><br/>3. Filter all hash-tags (words that start with a <code>#</code>)<br/>4. Filter out all empty topics (topic name only consists of hash-tag <code>#</code> itself)</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580370152461_-984548250","id":"20170220-182404_1394954195","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:267"},{"text":"val topics = (ts_text.select(\n        ts_text(\"timestamp\"), \n        explode(split(ts_text(\"text\"),\" \")).as(\"topic\")\n    )\n    .filter($\"topic\".startsWith(\"#\"))\n    .filter($\"topic\" =!= \"#\")\n)","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"topics: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [timestamp: timestamp, topic: string]\n"}]},"apps":[],"jobName":"paragraph_1580370152463_-983778752","id":"20170220-180159_930749179","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:268"},{"text":"%md\n## 3.3 Count Topics\n\nNow that we have the hash tags (topics), we perform a simple aggregation as usual: Group by hashtag (`topic`) and count number of tweets (using `count` or `sum(1)`)","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>3.3 Count Topics</h2>\n<p>Now that we have the hash tags (topics), we perform a simple aggregation as usual: Group by hashtag (<code>topic</code>) and count number of tweets (using <code>count</code> or <code>sum(1)</code>)</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580370152464_-973390532","id":"20170220-182554_1623876741","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:269"},{"text":"val counts = (topics\n    .groupBy(\"topic\")\n    .agg(sum(lit(1)).as(\"count\"))\n)","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"counts: org.apache.spark.sql.DataFrame = [topic: string, count: bigint]\n"}]},"apps":[],"jobName":"paragraph_1580370152466_-972621034","id":"20170218-160526_2008806660","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:270"},{"text":"counts.printSchema","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- topic: string (nullable = true)\n |-- count: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1580370152469_-975314277","id":"20170218-162308_1835168589","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:271"},{"text":"%md\n## 3.4 Print Results onto Console\n\nAgain we want to print the results onto the console.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.4 Print Results onto Console</h2>\n<p>Again we want to print the results onto the console.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152471_-974544779","id":"20170218-161041_735302634","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:272"},{"text":"val query = (counts.writeStream\n    .format(\"console\")\n    .outputMode(\"update\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-count-\" + System.currentTimeMillis())\n    .start())\n    \nThread.sleep(60000)\n\nquery.stop()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"query: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@31a9d498\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+---------------+-----+\n|          topic|count|\n+---------------+-----+\n|        #Hadith|    1|\n|         #강남풀사롱|    3|\n|         #강남야구장|    3|\n|          #강남술집|    1|\n|#NousLesVieuxOn|    1|\n|   #강남술집\n#강남풀싸롱|    2|\n|           #풀싸롱|    3|\n+---------------+-----+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+--------------------+-----+\n|               topic|count|\n+--------------------+-----+\n|              #Adana|    1|\n|                 #興津|    1|\n|                #ふぁぼ|    1|\n|              #bruin|    1|\n|                #갓세븐|    1|\n|               #oslo|    1|\n|           #nonsense|    1|\n|                #Web|    1|\n|     #nonsenseengine|    1|\n|          #ImWithHer|    2|\n|            #amateur|    1|\n|      #photooftheday|    1|\n|             #القصيم|    1|\n|#الهلال_افسد_الري...|    1|\n|              #بريدة|    1|\n|              #girls|    1|\n|                #JIN|    1|\n|#เซเลป5ใบ\nhttps:/...|    1|\n|            #retweet|    1|\n|              #FOX25|    1|\n+--------------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1580370152474_-975699026","id":"20170218-160613_988660270","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:273"},{"text":"","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580370152477_-978392268","id":"20170218-160716_194527039","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:274"},{"text":"%md\n# 4. Time-Windowed Aggregation\n\nAnother interesting (and probably more realistic) application is to perform time windowed aggregations. This means that we define a sliding time window used in the `groupBy` clause. In addition we also define a so called *watermark* which tells Spark how long to wait for late arrivels of individual data points (we don't have them in our simple example).","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>4. Time-Windowed Aggregation</h1>\n<p>Another interesting (and probably more realistic) application is to perform time windowed aggregations. This means that we define a sliding time window used in the <code>groupBy</code> clause. In addition we also define a so called <em>watermark</em> which tells Spark how long to wait for late arrivels of individual data points (we don't have them in our simple example).</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152480_-991858479","id":"20170218-164639_1471935006","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:275"},{"text":"val windowedCounts = (topics\n    .withWatermark(\"timestamp\", \"10 seconds\")\n    .groupBy(window($\"timestamp\", \"5 seconds\", \"1 seconds\"), $\"topic\")\n    .agg(sum(lit(1)).as(\"count\"))\n    )","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"windowedCounts: org.apache.spark.sql.DataFrame = [window: struct<start: timestamp, end: timestamp>, topic: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1580370152484_-993397475","id":"20170218-164703_2039341008","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:276"},{"text":"windowedCounts.printSchema()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- window: struct (nullable = true)\n |    |-- start: timestamp (nullable = true)\n |    |-- end: timestamp (nullable = true)\n |-- topic: string (nullable = true)\n |-- count: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1580370152488_-994936471","id":"20170218-165357_1483843188","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:277"},{"text":"%md\n## 4.1 Output Data\n\nLet's again output the data. This time, we also like to investigate the different output modes `append`, `complete` and `update`.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4.1 Output Data</h2>\n<p>Let's again output the data. This time, we also like to investigate the different output modes <code>append</code>, <code>complete</code> and <code>update</code>.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152494_-995705968","id":"20180405-191004_1783341391","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:278"},{"text":"val query = (windowedCounts.writeStream\n    .outputMode(\"update\")\n    .format(\"console\")\n    .trigger(ProcessingTime(\"1 seconds\"))\n    .queryName(\"topic_counts\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-console-\" + System.currentTimeMillis())\n    .start())   \n    \nThread.sleep(120000)\n\nquery.stop()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nquery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@70b660b3\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+------+-----+-----+\n|window|topic|count|\n+------+-----+-----+\n+------+-----+-----+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:55...|          #Singleแรก|    1|\n|[2018-11-22 09:55...|      #عجلان_واخوانه|    1|\n|[2018-11-22 09:55...|      #androidgames,|    1|\n|[2018-11-22 09:55...|                #سكس|    1|\n|[2018-11-22 09:55...|          #محمد_عساف|    1|\n|[2018-11-22 09:55...|               #รั้น|    1|\n|[2018-11-22 09:55...|          #เสียงสู๊ง|    1|\n|[2018-11-22 09:55...|#사설토토사이트추천\n#사설토토사...|    1|\n|[2018-11-22 09:55...|#사설토토사이트추천\n#사설토토사...|    1|\n|[2018-11-22 09:55...|      #عجلان_واخوانه|    1|\n|[2018-11-22 09:55...|          #SeoTricks|    1|\n|[2018-11-22 09:55...|      #ALDUBSafeZone|    1|\n|[2018-11-22 09:55...|               #GOT7|    1|\n|[2018-11-22 09:55...|      #enlightenment|    1|\n|[2018-11-22 09:55...|            #HOSTING|    1|\n|[2018-11-22 09:55...|            #فلم_سكس|    1|\n|[2018-11-22 09:55...|      #enlightenment|    1|\n|[2018-11-22 09:55...|         #MTVHottest|    1|\n|[2018-11-22 09:55...|      #Cumberfriends|    1|\n|[2018-11-22 09:55...|               #شهوه|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 2\n-------------------------------------------\n+--------------------+--------------+-----+\n|              window|         topic|count|\n+--------------------+--------------+-----+\n|[2018-11-22 09:55...|         #منبج|    1|\n|[2018-11-22 09:55...|   #NickiMinaj|    2|\n|[2018-11-22 09:55...|   #MTVHOTTEST|    1|\n|[2018-11-22 09:55...|#VeranoMTV2016|    1|\n|[2018-11-22 09:55...|   #NickiMinaj|    2|\n|[2018-11-22 09:55...|          #ライン|    1|\n|[2018-11-22 09:55...|   #MTVHOTTEST|    1|\n|[2018-11-22 09:55...|          #حلب|    1|\n|[2018-11-22 09:55...|         #منبج|    1|\n|[2018-11-22 09:55...|#HinkleyPoint!|    1|\n|[2018-11-22 09:55...|          #حمص|    1|\n|[2018-11-22 09:55...|         #منبج|    1|\n|[2018-11-22 09:55...|          #حلب|    1|\n|[2018-11-22 09:55...|          #حمص|    1|\n|[2018-11-22 09:55...|            #猫|    1|\n|[2018-11-22 09:55...|   #MTVHOTTEST|    2|\n|[2018-11-22 09:55...|          #ライン|    1|\n|[2018-11-22 09:55...|   #NickiMinaj|    2|\n|[2018-11-22 09:55...|   #MTVHOTTEST|    2|\n|[2018-11-22 09:55...|   #NickiMinaj|    1|\n+--------------------+--------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 3\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:56...|               #천안채팅|    1|\n|[2018-11-22 09:55...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:56...|      #AzadReporting|    1|\n|[2018-11-22 09:56...|            #의왕만남사이트|    1|\n|[2018-11-22 09:56...|               #채팅순위|    1|\n|[2018-11-22 09:56...|               #토렌트리|    1|\n|[2018-11-22 09:56...|               #채팅순위|    1|\n|[2018-11-22 09:55...|                  #뷔|    1|\n|[2018-11-22 09:56...|#يوم_الجمعة\n\nhttp...|    1|\n|[2018-11-22 09:56...|               #랜덤화상|    1|\n|[2018-11-22 09:56...|              #19금애니|    1|\n|[2018-11-22 09:56...|               #천안채팅|    1|\n|[2018-11-22 09:56...|#يوم_الجمعة\n\nhttp...|    1|\n|[2018-11-22 09:56...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:56...|               #레드트리|    1|\n|[2018-11-22 09:56...|                #엉덩이|    1|\n|[2018-11-22 09:56...|                  #뷔|    1|\n|[2018-11-22 09:56...|               #토렌트리|    1|\n|[2018-11-22 09:56...|              #방탄소년단|    1|\n|[2018-11-22 09:56...|               #레드트리|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 4\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:56...|          #Artiesays|    1|\n|[2018-11-22 09:56...|            #bonplan|    1|\n|[2018-11-22 09:56...|            #bonplan|    1|\n|[2018-11-22 09:56...|          #Artiesays|    1|\n|[2018-11-22 09:56...|          #Artiesays|    1|\n|[2018-11-22 09:56...|             #promos|    1|\n|[2018-11-22 09:56...|            #bonplan|    1|\n|[2018-11-22 09:56...|             #promos|    1|\n|[2018-11-22 09:56...| #savegonzalofonseca|    1|\n|[2018-11-22 09:56...|#このアニメ知ってる人で999RT...|    1|\n|[2018-11-22 09:56...| #savegonzalofonseca|    1|\n|[2018-11-22 09:56...|             #promos|    1|\n|[2018-11-22 09:56...|#このアニメ知ってる人で999RT...|    1|\n|[2018-11-22 09:56...|          #Artiesays|    1|\n|[2018-11-22 09:56...|            #bonplan|    1|\n|[2018-11-22 09:56...|#このアニメ知ってる人で999RT...|    1|\n|[2018-11-22 09:56...|            #bonplan|    1|\n|[2018-11-22 09:56...| #savegonzalofonseca|    1|\n|[2018-11-22 09:56...| #savegonzalofonseca|    1|\n|[2018-11-22 09:56...|#このアニメ知ってる人で999RT...|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 5\n-------------------------------------------\n+--------------------+-----------+-----+\n|              window|      topic|count|\n+--------------------+-----------+-----+\n|[2018-11-22 09:56...|#يوم_الجمعه|    1|\n|[2018-11-22 09:56...|#يوم_الجمعه|    1|\n|[2018-11-22 09:56...|#يوم_الجمعه|    1|\n|[2018-11-22 09:56...|#يوم_الجمعه|    1|\n|[2018-11-22 09:56...|#يوم_الجمعه|    1|\n+--------------------+-----------+-----+\n\n-------------------------------------------\nBatch: 6\n-------------------------------------------\n+--------------------+------------------+-----+\n|              window|             topic|count|\n+--------------------+------------------+-----+\n|[2018-11-22 09:56...|          #YouTube|    1|\n|[2018-11-22 09:56...|               #F1|    1|\n|[2018-11-22 09:56...|              #FP1|    1|\n|[2018-11-22 09:56...|              #FP1|    1|\n|[2018-11-22 09:56...|       #NickiMinaj|    1|\n|[2018-11-22 09:56...|            #young|    1|\n|[2018-11-22 09:56...|               #F1|    1|\n|[2018-11-22 09:56...|        #marketing|    1|\n|[2018-11-22 09:56...|    #VeranoMTV2016|    1|\n|[2018-11-22 09:56...|         #GermanGP|    1|\n|[2018-11-22 09:56...|         #GermanGP|    1|\n|[2018-11-22 09:56...|               #F1|    1|\n|[2018-11-22 09:56...|#HeatWaveIn4Words?|    1|\n|[2018-11-22 09:56...|       #NickiMinaj|    1|\n|[2018-11-22 09:56...|    #VeranoMTV2016|    1|\n|[2018-11-22 09:56...|          #YouTube|    1|\n|[2018-11-22 09:56...|       #NickiMinaj|    1|\n|[2018-11-22 09:56...|              #FP1|    1|\n|[2018-11-22 09:56...|               #F1|    1|\n|[2018-11-22 09:56...|        #marketing|    1|\n+--------------------+------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 7\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:56...|              #JAKEN|    1|\n|[2018-11-22 09:56...|          #Petrobras|    1|\n|[2018-11-22 09:56...|          #Petrobras|    1|\n|[2018-11-22 09:56...|               #コマサタ|    1|\n|[2018-11-22 09:56...|              #JAKEN|    1|\n|[2018-11-22 09:56...|               #HEAT|    1|\n|[2018-11-22 09:56...|             #skolan|    1|\n|[2018-11-22 09:56...|              #JAKEN|    1|\n|[2018-11-22 09:56...|          #Petrobras|    1|\n|[2018-11-22 09:56...|#嵐のメンバーの苗字から始めて予測...|    1|\n|[2018-11-22 09:56...|#嵐のメンバーの苗字から始めて予測...|    1|\n|[2018-11-22 09:56...|             #ยืมเมจ|    1|\n|[2018-11-22 09:56...|               #HEAT|    1|\n|[2018-11-22 09:56...|              #svpol|    1|\n|[2018-11-22 09:56...|              #svpol|    1|\n|[2018-11-22 09:56...|#嵐のメンバーの苗字から始めて予測...|    1|\n|[2018-11-22 09:56...|              #JAKEN|    1|\n|[2018-11-22 09:56...|               #コマサタ|    1|\n|[2018-11-22 09:56...|             #skolan|    1|\n|[2018-11-22 09:56...|             #skolan|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 8\n-------------------------------------------\n+--------------------+--------------+-----+\n|              window|         topic|count|\n+--------------------+--------------+-----+\n|[2018-11-22 09:56...|       #safari|    1|\n|[2018-11-22 09:56...|   #MTVHOTTEST|    1|\n|[2018-11-22 09:56...|   #MTVHOTTEST|    1|\n|[2018-11-22 09:56...|      #journey|    1|\n|[2018-11-22 09:56...|         #ootd|    1|\n|[2018-11-22 09:56...|         #ootd|    1|\n|[2018-11-22 09:56...|   #NickiMinaj|    1|\n|[2018-11-22 09:56...|      #journey|    1|\n|[2018-11-22 09:56...|   #NickiMinaj|    1|\n|[2018-11-22 09:56...| #mPLUSRewards|    1|\n|[2018-11-22 09:56...| #mPLUSRewards|    1|\n|[2018-11-22 09:56...|   #MTVHOTTEST|    1|\n|[2018-11-22 09:56...| #UCLGCongress|    1|\n|[2018-11-22 09:56...|   #NickiMinaj|    1|\n|[2018-11-22 09:56...|      #journey|    1|\n|[2018-11-22 09:56...| #UCLGCongress|    1|\n|[2018-11-22 09:56...|#VeranoMTV2016|    1|\n|[2018-11-22 09:56...|    #Habitat3.|    1|\n|[2018-11-22 09:56...| #UCLGCongress|    1|\n|[2018-11-22 09:56...|         #ootd|    1|\n+--------------------+--------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 9\n-------------------------------------------\n+--------------------+----------+-----+\n|              window|     topic|count|\n+--------------------+----------+-----+\n|[2018-11-22 09:56...|     #INwx|    1|\n|[2018-11-22 09:56...|     #INwx|    1|\n|[2018-11-22 09:56...|#PokemonGo|    1|\n|[2018-11-22 09:56...|#PokemonGo|    1|\n|[2018-11-22 09:56...|#PokemonGo|    1|\n|[2018-11-22 09:56...|#PokemonGo|    1|\n|[2018-11-22 09:56...|     #INwx|    1|\n|[2018-11-22 09:56...|     #INwx|    1|\n|[2018-11-22 09:56...|     #INwx|    1|\n|[2018-11-22 09:56...|#PokemonGo|    1|\n+--------------------+----------+-----+\n\n-------------------------------------------\nBatch: 10\n-------------------------------------------\n+--------------------+-------------+-----+\n|              window|        topic|count|\n+--------------------+-------------+-----+\n|[2018-11-22 09:56...|  #ArthurFist|    1|\n|[2018-11-22 09:56...|#شماغ_البسام\r|    1|\n|[2018-11-22 09:56...|  #ArthurFist|    1|\n|[2018-11-22 09:56...|         #mfs|    1|\n|[2018-11-22 09:56...|         #mfs|    1|\n|[2018-11-22 09:56...|         #mfs|    1|\n|[2018-11-22 09:56...|#شماغ_البسام\r|    1|\n|[2018-11-22 09:56...|  #ArthurFist|    1|\n|[2018-11-22 09:56...|         #mfs|    1|\n|[2018-11-22 09:56...|  #ArthurFist|    1|\n|[2018-11-22 09:56...|         #mfs|    1|\n|[2018-11-22 09:56...|#شماغ_البسام\r|    1|\n|[2018-11-22 09:56...|  #ArthurFist|    1|\n|[2018-11-22 09:56...|#شماغ_البسام\r|    1|\n|[2018-11-22 09:56...|#شماغ_البسام\r|    1|\n+--------------------+-------------+-----+\n\n-------------------------------------------\nBatch: 11\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:56...|               #pia…|    1|\n|[2018-11-22 09:56...|               #pia…|    1|\n|[2018-11-22 09:56...|                 #dj|    1|\n|[2018-11-22 09:56...|        #kaigaidrama|    1|\n|[2018-11-22 09:56...|          #KCAMexico|    3|\n|[2018-11-22 09:56...|     #JaramiYoutuber|    8|\n|[2018-11-22 09:56...|              #海外ドラマ|    1|\n|[2018-11-22 09:56...|         #MTVHottest|    1|\n|[2018-11-22 09:56...|#Facebook\nhttps:/...|    1|\n|[2018-11-22 09:56...|         #MTVHottest|    1|\n|[2018-11-22 09:56...|               #pia…|    1|\n|[2018-11-22 09:56...|#ابناء_محمد_السعد...|    1|\n|[2018-11-22 09:56...|#ابناء_محمد_السعد...|    1|\n|[2018-11-22 09:56...|                 #dj|    1|\n|[2018-11-22 09:56...|            #guitars|    1|\n|[2018-11-22 09:56...|            #guitars|    1|\n|[2018-11-22 09:56...|              #海外ドラマ|    1|\n|[2018-11-22 09:56...|        #kaigaidrama|    1|\n|[2018-11-22 09:56...|        #kaigaidrama|    1|\n|[2018-11-22 09:56...|        #kaigaidrama|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 12\n-------------------------------------------\n+------+-----+-----+\n|window|topic|count|\n+------+-----+-----+\n+------+-----+-----+\n\n-------------------------------------------\nBatch: 13\n-------------------------------------------\n+--------------------+--------------+-----+\n|              window|         topic|count|\n+--------------------+--------------+-----+\n|[2018-11-22 09:56...| #officedesign|    1|\n|[2018-11-22 09:56...|     #business|    1|\n|[2018-11-22 09:56...|    #StoPPriv…|    1|\n|[2018-11-22 09:56...|     #business|    1|\n|[2018-11-22 09:56...|    #StoPPriv…|    1|\n|[2018-11-22 09:56...|#RTした人全員フォローする|    1|\n|[2018-11-22 09:56...|     #RegMedXB|    1|\n|[2018-11-22 09:56...|    #StoPPriv…|    1|\n|[2018-11-22 09:56...|          #PPS|    1|\n|[2018-11-22 09:56...|     #business|    1|\n|[2018-11-22 09:56...|       #office|    1|\n|[2018-11-22 09:56...| #officedesign|    1|\n|[2018-11-22 09:56...|          #PPS|    1|\n|[2018-11-22 09:56...|     #RegMedXB|    1|\n|[2018-11-22 09:56...|      #BigData|    1|\n|[2018-11-22 09:56...|#RTした人全員フォローする|    1|\n|[2018-11-22 09:56...|      #BigData|    1|\n|[2018-11-22 09:56...|       #office|    1|\n|[2018-11-22 09:56...|       #ياصالح|    1|\n|[2018-11-22 09:56...| #officedesign|    1|\n+--------------------+--------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 14\n-------------------------------------------\n+--------------------+----------+-----+\n|              window|     topic|count|\n+--------------------+----------+-----+\n|[2018-11-22 09:56...|       #BQ|    1|\n|[2018-11-22 09:56...|       #BQ|    1|\n|[2018-11-22 09:56...|      #дна|    1|\n|[2018-11-22 09:56...|       #BQ|    1|\n|[2018-11-22 09:56...|    #Кодак|    1|\n|[2018-11-22 09:56...|  #каскада|    1|\n|[2018-11-22 09:56...|      #дна|    1|\n|[2018-11-22 09:56...|  #каскада|    1|\n|[2018-11-22 09:56...|#เสียงสู๊ง|    1|\n|[2018-11-22 09:56...|#เสียงสู๊ง|    1|\n|[2018-11-22 09:56...|      #дна|    1|\n|[2018-11-22 09:56...|  #каскада|    1|\n|[2018-11-22 09:56...|#เสียงสู๊ง|    1|\n|[2018-11-22 09:56...|       #BQ|    1|\n|[2018-11-22 09:56...|    #Кодак|    1|\n|[2018-11-22 09:56...|    #Кодак|    1|\n|[2018-11-22 09:56...|    #Кодак|    1|\n|[2018-11-22 09:56...|      #дна|    1|\n|[2018-11-22 09:56...|      #дна|    1|\n|[2018-11-22 09:56...|  #каскада|    1|\n+--------------------+----------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 15\n-------------------------------------------\n+--------------------+-------------------+-----+\n|              window|              topic|count|\n+--------------------+-------------------+-----+\n|[2018-11-22 09:56...|                #63|    1|\n|[2018-11-22 09:56...|          #трейдинг|    1|\n|[2018-11-22 09:56...|              #cool|    1|\n|[2018-11-22 09:56...|              #cool|    1|\n|[2018-11-22 09:56...|              #ммвб|    1|\n|[2018-11-22 09:56...|       #gameinsight|    1|\n|[2018-11-22 09:56...|          #PowerHit|    1|\n|[2018-11-22 09:56...|          #трейдинг|    1|\n|[2018-11-22 09:56...|     #androidgames,|    1|\n|[2018-11-22 09:56...|          #android,|    1|\n|[2018-11-22 09:56...|           #Venerdi|    1|\n|[2018-11-22 09:56...|          #android,|    1|\n|[2018-11-22 09:56...|#CombinationSavings|    1|\n|[2018-11-22 09:56...|          #PowerHit|    1|\n|[2018-11-22 09:56...|              #cool|    1|\n|[2018-11-22 09:56...|              #cool|    1|\n|[2018-11-22 09:56...|             #Super|    1|\n|[2018-11-22 09:56...|              #ммвб|    1|\n|[2018-11-22 09:56...|          #APartete|    1|\n|[2018-11-22 09:56...|#CombinationSavings|    1|\n+--------------------+-------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 16\n-------------------------------------------\n+--------------------+-------------------+-----+\n|              window|              topic|count|\n+--------------------+-------------------+-----+\n|[2018-11-22 09:56...| #मानसिक_रोगी_केजरी|    1|\n|[2018-11-22 09:56...| #मानसिक_रोगी_केजरी|    1|\n|[2018-11-22 09:56...|          #เสียงสูง|    1|\n|[2018-11-22 09:56...|          #เสียงสูง|    1|\n|[2018-11-22 09:56...| #मानसिक_रोगी_केजरी|    1|\n|[2018-11-22 09:56...|#ทีมเสือกและแดกไปพ…|    1|\n|[2018-11-22 09:56...|#ทีมเสือกและแดกไปพ…|    1|\n|[2018-11-22 09:56...|     #GoodVibesOnly|    1|\n|[2018-11-22 09:56...|#ทีมเสือกและแดกไปพ…|    1|\n|[2018-11-22 09:56...|     #GoodVibesOnly|    1|\n|[2018-11-22 09:56...|#ทีมเสือกและแดกไปพ…|    1|\n|[2018-11-22 09:56...|          #เสียงสูง|    1|\n|[2018-11-22 09:56...|     #GoodVibesOnly|    1|\n|[2018-11-22 09:56...|#ทีมเสือกและแดกไปพ…|    1|\n|[2018-11-22 09:56...| #मानसिक_रोगी_केजरी|    1|\n|[2018-11-22 09:56...|     #GoodVibesOnly|    1|\n|[2018-11-22 09:56...|          #เสียงสูง|    1|\n|[2018-11-22 09:56...|     #GoodVibesOnly|    1|\n|[2018-11-22 09:56...|          #เสียงสูง|    1|\n|[2018-11-22 09:56...| #मानसिक_रोगी_केजरी|    1|\n+--------------------+-------------------+-----+\n\n-------------------------------------------\nBatch: 17\n-------------------------------------------\n+--------------------+------------------+-----+\n|              window|             topic|count|\n+--------------------+------------------+-----+\n|[2018-11-22 09:56...|#GetWellSoonJongin|    1|\n|[2018-11-22 09:56...|         #FireInMe|    1|\n|[2018-11-22 09:56...|               #on|    1|\n|[2018-11-22 09:56...|            #jobb\n|    1|\n|[2018-11-22 09:56...|              #KAI|    1|\n|[2018-11-22 09:56...|               #on|    1|\n|[2018-11-22 09:56...|   #GetWellSoonKai|    1|\n|[2018-11-22 09:56...|             #jobs|    1|\n|[2018-11-22 09:56...|               #카이|    1|\n|[2018-11-22 09:56...|#GetWellSoonJongin|    1|\n|[2018-11-22 09:56...| #เมเจอร์ปิ่นเกล้า|    1|\n|[2018-11-22 09:56...|               #on|    1|\n|[2018-11-22 09:56...|             #jobs|    1|\n|[2018-11-22 09:56...|              #KAI|    1|\n|[2018-11-22 09:56...|         #LinkedIn|    1|\n|[2018-11-22 09:56...|               #on|    1|\n|[2018-11-22 09:56...|           #Norway|    1|\n|[2018-11-22 09:56...|             #jobs|    1|\n|[2018-11-22 09:56...|         #LinkedIn|    1|\n|[2018-11-22 09:56...|   #GetWellSoonKai|    1|\n+--------------------+------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 18\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:56...|#MSGsaysLeaveJeal...|    1|\n|[2018-11-22 09:56...|#MSGsaysLeaveJeal...|    1|\n|[2018-11-22 09:56...|#MSGsaysLeaveJeal...|    1|\n|[2018-11-22 09:56...|#MSGsaysLeaveJeal...|    1|\n|[2018-11-22 09:56...|#MSGsaysLeaveJeal...|    1|\n+--------------------+--------------------+-----+\n\n-------------------------------------------\nBatch: 19\n-------------------------------------------\n+--------------------+----------------+-----+\n|              window|           topic|count|\n+--------------------+----------------+-----+\n|[2018-11-22 09:56...|      #ALDUBSaf…|    1|\n|[2018-11-22 09:56...|  #20AñosPokémon|    1|\n|[2018-11-22 09:56...|      #stockings|    1|\n|[2018-11-22 09:57...|  #20AñosPokémon|    1|\n|[2018-11-22 09:56...|      #stockings|    1|\n|[2018-11-22 09:56...|      #PlusMinus|    1|\n|[2018-11-22 09:56...|      #cumontits|    1|\n|[2018-11-22 09:56...|            #sex|    1|\n|[2018-11-22 09:56...|  #20AñosPokémon|    1|\n|[2018-11-22 09:57...|  #20AñosPokémon|    1|\n|[2018-11-22 09:56...|      #PlusMinus|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:56...|  #ALDUBSafeZone|    1|\n|[2018-11-22 09:56...|      #stockings|    1|\n|[2018-11-22 09:56...|         #Diesel|    1|\n|[2018-11-22 09:56...|      #cumontits|    1|\n|[2018-11-22 09:56...|      #PlusMinus|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|  #ALDUBSafeZone|    1|\n+--------------------+----------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 20\n-------------------------------------------\n+--------------------+--------------+-----+\n|              window|         topic|count|\n+--------------------+--------------+-----+\n|[2018-11-22 09:56...|          #크나큰|    1|\n|[2018-11-22 09:57...|          #크나큰|    1|\n|[2018-11-22 09:57...|#enlightenment|    1|\n|[2018-11-22 09:57...|           #승준|    1|\n|[2018-11-22 09:56...|          #knk|    1|\n|[2018-11-22 09:57...|          #knk|    1|\n|[2018-11-22 09:56...|          #박승준|    1|\n|[2018-11-22 09:57...|#enlightenment|    1|\n|[2018-11-22 09:56...|           #승준|    1|\n|[2018-11-22 09:57...|          #knk|    1|\n|[2018-11-22 09:57...|#enlightenment|    1|\n|[2018-11-22 09:57...|          #크나큰|    1|\n|[2018-11-22 09:57...|           #승준|    1|\n|[2018-11-22 09:57...|          #박승준|    1|\n|[2018-11-22 09:57...|#enlightenment|    1|\n|[2018-11-22 09:57...|          #knk|    1|\n|[2018-11-22 09:57...|           #승준|    1|\n|[2018-11-22 09:57...|          #크나큰|    1|\n|[2018-11-22 09:57...|          #박승준|    1|\n|[2018-11-22 09:57...|          #박승준|    1|\n+--------------------+--------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 21\n-------------------------------------------\n+--------------------+------------------+-----+\n|              window|             topic|count|\n+--------------------+------------------+-----+\n|[2018-11-22 09:57...|       #MTVHottest|    1|\n|[2018-11-22 09:57...|         #Veterans|    1|\n|[2018-11-22 09:57...|              #DoD|    1|\n|[2018-11-22 09:57...|         #Veterans|    1|\n|[2018-11-22 09:57...|              #DoD|    1|\n|[2018-11-22 09:57...|               #RT|    1|\n|[2018-11-22 09:57...|               #RT|    1|\n|[2018-11-22 09:57...|         #520PROMO|    1|\n|[2018-11-22 09:57...|              #Job|    1|\n|[2018-11-22 09:57...|           #hiring|    1|\n|[2018-11-22 09:57...|         #Veterans|    1|\n|[2018-11-22 09:57...|           #hiring|    1|\n|[2018-11-22 09:57...|       #MTVHottest|    1|\n|[2018-11-22 09:57...|             #Jobs|    1|\n|[2018-11-22 09:57...|             #Jobs|    1|\n|[2018-11-22 09:57...|       #MTVHottest|    1|\n|[2018-11-22 09:57...|#humanityaimsofmsg|    1|\n|[2018-11-22 09:57...|               #RT|    1|\n|[2018-11-22 09:57...|#humanityaimsofmsg|    1|\n|[2018-11-22 09:57...|        #Djibouti!|    1|\n+--------------------+------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 22\n-------------------------------------------\n+--------------------+-------------------+-----+\n|              window|              topic|count|\n+--------------------+-------------------+-----+\n|[2018-11-22 09:57...|#PushAwardsLizQuens|    1|\n|[2018-11-22 09:57...|      #tomorrowland|    1|\n|[2018-11-22 09:57...|#PushAwardsLizQuens|    1|\n|[2018-11-22 09:57...|      #tomorrowland|    1|\n|[2018-11-22 09:57...|  #tomorrowland2016|    1|\n|[2018-11-22 09:57...|  #tomorrowland2016|    1|\n|[2018-11-22 09:57...|#DolceAmoreSabotage|    1|\n|[2018-11-22 09:57...|      #tomorrowland|    1|\n|[2018-11-22 09:57...|#PushAwardsLizQuens|    1|\n|[2018-11-22 09:57...|#PushAwardsLizQuens|    1|\n|[2018-11-22 09:57...|  #tomorrowland2016|    1|\n|[2018-11-22 09:57...|      #tomorrowland|    1|\n|[2018-11-22 09:57...|  #tomorrowland2016|    1|\n|[2018-11-22 09:57...|#DolceAmoreSabotage|    1|\n|[2018-11-22 09:57...|  #tomorrowland2016|    1|\n|[2018-11-22 09:57...|#PushAwardsLizQuens|    1|\n|[2018-11-22 09:57...|#DolceAmoreSabotage|    1|\n|[2018-11-22 09:57...|      #tomorrowland|    1|\n|[2018-11-22 09:57...|#DolceAmoreSabotage|    1|\n|[2018-11-22 09:57...|#DolceAmoreSabotage|    1|\n+--------------------+-------------------+-----+\n\n-------------------------------------------\nBatch: 23\n-------------------------------------------\n+--------------------+----------------+-----+\n|              window|           topic|count|\n+--------------------+----------------+-----+\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|    #BTSinManila|    1|\n|[2018-11-22 09:57...|     #MTVHottest|    1|\n|[2018-11-22 09:57...|        #Defense|    1|\n|[2018-11-22 09:57...|        #Defense|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|     #MTVHottest|    1|\n|[2018-11-22 09:57...|     #MTVHottest|    2|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|     #Нацгвардія|    1|\n|[2018-11-22 09:57...|        #Defense|    1|\n|[2018-11-22 09:57...|     #Нацгвардія|    1|\n|[2018-11-22 09:57...|        #Defense|    1|\n|[2018-11-22 09:57...|     #MTVHottest|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|#HealthTipsByMSG|    1|\n|[2018-11-22 09:57...|    #BTSinManila|    1|\n|[2018-11-22 09:57...|     #Нацгвардія|    1|\n|[2018-11-22 09:57...|     #Нацгвардія|    1|\n|[2018-11-22 09:57...|        #Defense|    1|\n+--------------------+----------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 24\n-------------------------------------------\n+--------------------+-------------+-----+\n|              window|        topic|count|\n+--------------------+-------------+-----+\n|[2018-11-22 09:57...|#ひと夏分のハーゲンダッツ|    1|\n|[2018-11-22 09:57...|#ひと夏分のハーゲンダッツ|    1|\n|[2018-11-22 09:57...|#ひと夏分のハーゲンダッツ|    1|\n|[2018-11-22 09:57...|#ひと夏分のハーゲンダッツ|    1|\n|[2018-11-22 09:57...|#ひと夏分のハーゲンダッツ|    1|\n+--------------------+-------------+-----+\n\n-------------------------------------------\nBatch: 25\n-------------------------------------------\n+--------------------+-----------+-----+\n|              window|      topic|count|\n+--------------------+-----------+-----+\n|[2018-11-22 09:57...|#HITZZOMBIE|    1|\n|[2018-11-22 09:57...|  #RTVlive:|    1|\n|[2018-11-22 09:57...| #Yahooニュース|    1|\n|[2018-11-22 09:57...|       #심규선|    1|\n|[2018-11-22 09:57...|       #루시아|    1|\n|[2018-11-22 09:57...|       #루시아|    1|\n|[2018-11-22 09:57...| #Yahooニュース|    1|\n|[2018-11-22 09:57...|#HITZZOMBIE|    1|\n|[2018-11-22 09:57...|       #루시아|    1|\n|[2018-11-22 09:57...|#HITZZOMBIE|    1|\n|[2018-11-22 09:57...|       #심규선|    1|\n|[2018-11-22 09:57...|  #RTVlive:|    1|\n|[2018-11-22 09:57...|       #심규선|    1|\n|[2018-11-22 09:57...|       #루시아|    1|\n|[2018-11-22 09:57...|       #심규선|    1|\n|[2018-11-22 09:57...|  #RTVlive:|    1|\n|[2018-11-22 09:57...| #Yahooニュース|    1|\n|[2018-11-22 09:57...|       #루시아|    1|\n|[2018-11-22 09:57...|  #RTVlive:|    1|\n|[2018-11-22 09:57...| #Yahooニュース|    1|\n+--------------------+-----------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 26\n-------------------------------------------\n+------+-----+-----+\n|window|topic|count|\n+------+-----+-----+\n+------+-----+-----+\n\n-------------------------------------------\nBatch: 27\n-------------------------------------------\n+--------------------+--------------+-----+\n|              window|         topic|count|\n+--------------------+--------------+-----+\n|[2018-11-22 09:57...|            #…|    1|\n|[2018-11-22 09:57...|#PapaFrancesco|    1|\n|[2018-11-22 09:57...|       #TV2000|    1|\n|[2018-11-22 09:57...|#PapaFrancesco|    1|\n|[2018-11-22 09:57...|       #TV2000|    1|\n|[2018-11-22 09:57...|            #…|    1|\n|[2018-11-22 09:57...|#PapaFrancesco|    1|\n|[2018-11-22 09:57...|   #xenophobie|    1|\n|[2018-11-22 09:57...|       #TV2000|    1|\n|[2018-11-22 09:57...|           #FF|    1|\n|[2018-11-22 09:57...|   #Auschwitz,|    1|\n|[2018-11-22 09:57...|            #…|    1|\n|[2018-11-22 09:57...|          #NHS|    1|\n|[2018-11-22 09:57...|          #NHS|    1|\n|[2018-11-22 09:57...|           #FF|    1|\n|[2018-11-22 09:57...|#PapaFrancesco|    1|\n|[2018-11-22 09:57...|   #Auschwitz,|    1|\n|[2018-11-22 09:57...|       #TV2000|    1|\n|[2018-11-22 09:57...|          #NHS|    1|\n|[2018-11-22 09:57...|       #TV2000|    1|\n+--------------------+--------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 28\n-------------------------------------------\n+--------------------+----------------+-----+\n|              window|           topic|count|\n+--------------------+----------------+-----+\n|[2018-11-22 09:57...|     #MTVHOTTEST|    2|\n|[2018-11-22 09:57...|#GuerraPersonale|    1|\n|[2018-11-22 09:57...|     #MTVHOTTEST|    1|\n|[2018-11-22 09:57...|  #VeranoMTV2016|    1|\n|[2018-11-22 09:57...|     #MTVHOTTEST|    2|\n|[2018-11-22 09:57...|  #VeranoMTV2016|    1|\n|[2018-11-22 09:57...|  #VeranoMTV2016|    1|\n|[2018-11-22 09:57...|     #MTVHOTTEST|    1|\n|[2018-11-22 09:57...|     #NickiMinaj|    1|\n|[2018-11-22 09:57...|     #MTVHOTTEST|    2|\n|[2018-11-22 09:57...|     #NickiMinaj|    1|\n|[2018-11-22 09:57...|  #VeranoMTV2016|    1|\n|[2018-11-22 09:57...|     #NickiMinaj|    1|\n|[2018-11-22 09:57...|     #NickiMinaj|    1|\n|[2018-11-22 09:57...|#GuerraPersonale|    1|\n|[2018-11-22 09:57...|#GuerraPersonale|    1|\n|[2018-11-22 09:57...|     #NickiMinaj|    1|\n|[2018-11-22 09:57...|     #MTVHOTTEST|    2|\n|[2018-11-22 09:57...|#GuerraPersonale|    1|\n|[2018-11-22 09:57...|#GuerraPersonale|    1|\n+--------------------+----------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 29\n-------------------------------------------\n+--------------------+-----+-----+\n|              window|topic|count|\n+--------------------+-----+-----+\n|[2018-11-22 09:57...|#LARC|    1|\n|[2018-11-22 09:57...|#LARC|    1|\n|[2018-11-22 09:57...|#LARC|    1|\n|[2018-11-22 09:57...|#LARC|    1|\n|[2018-11-22 09:57...|#LARC|    1|\n+--------------------+-----+-----+\n\n-------------------------------------------\nBatch: 30\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2018-11-22 09:57...|#ThreeEmptyWordsA...|    1|\n|[2018-11-22 09:57...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:57...|#ThreeEmptyWordsA...|    1|\n|[2018-11-22 09:57...|#ThreeEmptyWordsA...|    1|\n|[2018-11-22 09:57...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:57...|               #あんスタ|    1|\n|[2018-11-22 09:57...|               #あんスタ|    1|\n|[2018-11-22 09:57...|#ThreeEmptyWordsA...|    1|\n|[2018-11-22 09:57...|               #あんスタ|    1|\n|[2018-11-22 09:57...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:57...|               #あんスタ|    1|\n|[2018-11-22 09:57...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:57...|#사설토토추천사이트\n#사설토토사...|    1|\n|[2018-11-22 09:57...|               #あんスタ|    1|\n|[2018-11-22 09:57...|#ThreeEmptyWordsA...|    1|\n+--------------------+--------------------+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1580370152501_-987626241","id":"20170218-162247_324928954","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:279"},{"text":"%md\n## 4.2 Create Dynamic Table\n\nWe can also use a \"memory\" output, which is a queryable live table. In order to do so, we again create a new table, but this time with format `memory` and an explicit query name `topic_counts`. Using a `memory` output will create a dynamic table in memory (only `complete` output supported right now), which can be queried using SQL.\n\n1. Create a DataStreamWriter object using the writeStream method of your DataFrame `windowedCounts`.\n2. Set the format to `memory`\n3. Set the output mode to `append` (this is supported for time windowed aggregations)\n4. Set the query name to `topic_counts`\n5. Specify a checkPointLocation on HDFS (ok, this is not trivial, so it is in the code below)\n6. Start the continuous query via `start`","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4.2 Create Dynamic Table</h2>\n<p>We can also use a &ldquo;memory&rdquo; output, which is a queryable live table. In order to do so, we again create a new table, but this time with format <code>memory</code> and an explicit query name <code>topic_counts</code>. Using a <code>memory</code> output will create a dynamic table in memory (only <code>complete</code> output supported right now), which can be queried using SQL.</p>\n<ol>\n<li>Create a DataStreamWriter object using the writeStream method of your DataFrame <code>windowedCounts</code>.</li>\n<li>Set the format to <code>memory</code></li>\n<li>Set the output mode to <code>append</code> (this is supported for time windowed aggregations)</li>\n<li>Set the query name to <code>topic_counts</code></li>\n<li>Specify a checkPointLocation on HDFS (ok, this is not trivial, so it is in the code below)</li>\n<li>Start the continuous query via <code>start</code></li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1580370152505_-989165237","id":"20170218-160934_1425298948","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:280"},{"text":"val tableQuery = (windowedCounts.writeStream\n    .outputMode(\"append\")\n    .format(\"memory\")\n    .trigger(ProcessingTime(\"1 seconds\"))\n    .queryName(\"topic_counts\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-table-\" + System.currentTimeMillis())\n    .start())","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\ntableQuery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@2b82fb92\n"}]},"apps":[],"jobName":"paragraph_1580370152508_-990319484","id":"20170218-161145_208429016","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:281"},{"text":"%md\n## 4.3 Perform Query\n\nNow that we have a dynamic table, we can perform SQL queries against this table as if it was a normal static table.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4.3 Perform Query</h2>\n<p>Now that we have a dynamic table, we can perform SQL queries against this table as if it was a normal static table.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152510_-989549986","id":"20170218-162010_1110788275","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:282"},{"text":"%sql\nselect \n    * \nfrom topic_counts\norder by count desc\nlimit 10","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"window","index":0,"aggr":"sum"}],"values":[{"name":"topic","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"window","index":0,"aggr":"sum"}},"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"window":"string","topic":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"window\ttopic\tcount\n[2018-11-22 09:59:33.0,2018-11-22 09:59:38.0]\t#KCAMexico\t4\n[2018-11-22 09:59:37.0,2018-11-22 09:59:42.0]\t#AnahiTrendy\t4\n[2018-11-22 09:59:33.0,2018-11-22 09:59:38.0]\t#AnahiTrendy\t4\n[2018-11-22 09:59:34.0,2018-11-22 09:59:39.0]\t#AnahiTrendy\t4\n[2018-11-22 09:59:36.0,2018-11-22 09:59:41.0]\t#KCAMexico\t4\n[2018-11-22 09:59:37.0,2018-11-22 09:59:42.0]\t#KCAMexico\t4\n[2018-11-22 09:59:34.0,2018-11-22 09:59:39.0]\t#KCAMexico\t4\n[2018-11-22 09:59:35.0,2018-11-22 09:59:40.0]\t#AnahiTrendy\t4\n[2018-11-22 09:59:35.0,2018-11-22 09:59:40.0]\t#KCAMexico\t4\n[2018-11-22 09:59:36.0,2018-11-22 09:59:41.0]\t#AnahiTrendy\t4\n"}]},"apps":[],"jobName":"paragraph_1580370152511_-989934735","id":"20170218-161337_1103351127","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:283"},{"text":"%md\n## 4.4 Stop Query\n\nIn order to clean everything up, we stop the query again.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4.4 Stop Query</h2>\n<p>In order to clean everything up, we stop the query again.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152513_-1004555193","id":"20170218-162048_842521010","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:284"},{"text":"tableQuery.stop()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":[],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580370152515_-1003785695","id":"20170218-161329_1844676678","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:285"},{"text":"%md\n# 5. SQL Output\n\nA more meaningful example will store the results in a MySQL database. This allows us better experiments with different output modes and does not require the `Thread.sleep` hack. In order to be able to access the MySQL driver, we need to add the following dependency manually to Zeppelin:\n\n    mysql:mysql-connector-java:6.0.6 \n\nThen we are ready to implement a special `ForeachSink` which allows to output streaming results to arbitrary sinks.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>5. SQL Output</h1>\n<p>A more meaningful example will store the results in a MySQL database. This allows us better experiments with different output modes and does not require the <code>Thread.sleep</code> hack. In order to be able to access the MySQL driver, we need to add the following dependency manually to Zeppelin:</p>\n<pre><code>mysql:mysql-connector-java:6.0.6 \n</code></pre>\n<p>Then we are ready to implement a special <code>ForeachSink</code> which allows to output streaming results to arbitrary sinks.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152516_-1005709440","id":"20180405-190358_1697918875","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:286"},{"text":"%md\n## 5.1 Create JDBCSink\n\nBy extending the class `ForeachWriter` we implement a JDBC sink which writes into a MySQL database. We use UPSERTs in order to be able to process updated data, when we set the output mode to `update`.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5.1 Create JDBCSink</h2>\n<p>By extending the class <code>ForeachWriter</code> we implement a JDBC sink which writes into a MySQL database. We use UPSERTs in order to be able to process updated data, when we set the output mode to <code>update</code>.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152518_-1004939942","id":"20180409-184840_694173197","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:287"},{"text":"\nclass JDBCSink(url: String, user:String, pwd:String) extends org.apache.spark.sql.ForeachWriter[org.apache.spark.sql.Row] {\n    import org.apache.commons.lang.StringEscapeUtils\n    \n    val driver = \"com.mysql.cj.jdbc.Driver\"\n\n    @transient var connection:java.sql.Connection = _\n    @transient var statement:java.sql.Statement = _\n\n    def open(partitionId: Long, version: Long):Boolean = {\n        Class.forName(driver)\n        connection = java.sql.DriverManager.getConnection(url, user, pwd)\n        statement = connection.createStatement\n        true\n    }\n\n    def process(value: org.apache.spark.sql.Row): Unit = { \n        try {\n            val ts = value(0).toString\n            val topic = StringEscapeUtils.escapeSql(value.getString(1))\n            val freq = value.getLong(2)            \n            statement.executeUpdate(s\"INSERT INTO twitter_topics(ts, topic, frequency) VALUES ('$ts','$topic',$freq) ON DUPLICATE KEY UPDATE frequency=$freq;\")\n        }\n        catch {\n            case t:Throwable =>\n        }\n    }\n\n    def close(errorOrNull:Throwable):Unit = {\n        connection.close\n        connection = null\n        statement = null\n    }\n}\n","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class JDBCSink\n"}]},"apps":[],"jobName":"paragraph_1580370152519_-1005324691","id":"20180409-183738_1503870515","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:288"},{"text":"val url = \"jdbc:mysql://kku.training.dimajix-aws.net/training\"\nval user = \"user\"\nval pwd = \"user\"\n\nval sink = new JDBCSink(url, user, pwd)","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"url: String = jdbc:mysql://kku.training.dimajix-aws.net/training\nuser: String = user\npwd: String = user\nsink: JDBCSink = JDBCSink@72015bee\n"}]},"apps":[],"jobName":"paragraph_1580370152521_-1007633184","id":"20180409-184057_55953501","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:289"},{"text":"%md\n## 5.2 Create Target Table\n\nIn order to store the results in MySQL, we need to create an appropriate table in MySQL. We use shell commands for that.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5.2 Create Target Table</h2>\n<p>In order to store the results in MySQL, we need to create an appropriate table in MySQL. We use shell commands for that.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152522_-1006478938","id":"20180409-185001_2128857477","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:290"},{"text":"%sh\nmysql --user=user --password=user -e \"CREATE TABLE IF NOT EXISTS training.twitter_topics (ts TIMESTAMP NOT NULL DEFAULT 0, topic VARCHAR(128) NOT NULL, frequency INT NULL, PRIMARY KEY (ts, topic))\"","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580370152524_-1008787431","id":"20180409-185155_1814796043","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:291"},{"text":"%md\n## 5.3 Perform Aggregation\n\nNow we generate the streaming aggregation again as usual.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5.3 Perform Aggregation</h2>\n<p>Now we generate the streaming aggregation again as usual.</p>\n"}]},"apps":[],"jobName":"paragraph_1580370152525_-1009172180","id":"20180409-185111_1502227523","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:292"},{"text":"val windowedCounts = topics\n    .withWatermark(\"ts\", \"90 seconds\")\n    .groupBy(window($\"ts\", \"30 seconds\"), $\"topic\")\n    .agg(sum(lit(1)).as(\"count\"))\n    .coalesce(10)\n    .select(col(\"window.end\"), col(\"topic\"), col(\"count\"))\n    \nwindowedCounts.printSchema()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"windowedCounts: org.apache.spark.sql.DataFrame = [end: timestamp, topic: string ... 1 more field]\nroot\n |-- end: timestamp (nullable = true)\n |-- topic: string (nullable = true)\n |-- count: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1580370152527_-1008402682","id":"20180409-184415_1712878112","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:293"},{"text":"%md\n## 5.4 Execute Streaming Query\n\nFinally we start the query. We use the `update` output mode in order to have a low latency of partial results. Triggers should happen every 5 seconds.","dateUpdated":"2020-01-30T07:42:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>5.4 Execute Streaming Query</h2>\n<p>Finally we start the query. We use the <code>update</code> output mode in order to have a low latency of partial results. Triggers should happen every 5 seconds.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580370152528_-998014462","id":"20180409-185131_1741905905","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:294"},{"text":"import org.apache.spark.sql.streaming.ProcessingTime\n\nval query = windowedCounts.writeStream\n    .foreach(sink)\n    .outputMode(\"update\")\n    .trigger(ProcessingTime(\"5 seconds\"))\n    .queryName(\"topic_counts\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-\" + System.currentTimeMillis())\n    .start()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.streaming.ProcessingTime\nwarning: there was one deprecation warning; re-run with -deprecation for details\nquery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@445d5b49\n"}]},"apps":[],"jobName":"paragraph_1580370152530_-997244964","id":"20180409-184151_1626285404","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:295"},{"text":"query.stop()","dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580370152531_-997629713","id":"20180409-190028_1292220214","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:296"},{"dateUpdated":"2020-01-30T07:42:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580370152533_-999938206","id":"20180409-190501_2093504126","dateCreated":"2020-01-30T07:42:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:297"}],"name":"Twitter Structured Streaming - Full","id":"2F2AWSXX8","angularObjects":{"2D8DSN3N4:shared_process":[],"2D7W55G1J:shared_process":[],"2DA3X6UGN:shared_process":[],"2D9HTU14T:shared_process":[],"2DBA6X8JB:shared_process":[],"2DBSCZXK2:shared_process":[],"2D9M853BP:shared_process":[],"2DAXFQ4X2:shared_process":[],"2DB3TEGGU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}