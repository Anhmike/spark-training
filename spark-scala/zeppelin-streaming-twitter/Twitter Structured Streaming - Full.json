{"paragraphs":[{"text":"%md\n# 1. Connect to data source\n\nFirst you need to run the netcat program, for example via\n\n    s3netcat.py -I1 -B10 -P9977 s3://dimajix-training/data/twitter-sample/\n\nThen we connect to the raw data socket as the datasource by using the `DataStreamReader` API via `spark.readStream`. We need to specify the options `host`, `port` and we need to use the format `socket` for connecting to the data source. The socket will stream Twitter data samples in raw JSON format, i.e. one JSON document per line.","dateUpdated":"2018-04-05T19:49:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>1. Connect to data source</h1>\n<p>First you need to run the netcat program, for example via</p>\n<pre><code>s3netcat.py -I1 -B10 -P9977 s3://dimajix-training/data/twitter-sample/\n</code></pre>\n<p>Then we connect to the raw data socket as the datasource by using the <code>DataStreamReader</code> API via <code>spark.readStream</code>. We need to specify the options <code>host</code>, <code>port</code> and we need to use the format <code>socket</code> for connecting to the data source. The socket will stream Twitter data samples in raw JSON format, i.e. one JSON document per line.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584752_-1240231205","id":"20170218-160028_195174762","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7994","user":"anonymous","dateFinished":"2018-04-05T19:49:32+0000","dateStarted":"2018-04-05T19:49:32+0000"},{"text":"// Fill in the correct AWS VPC address of your master host\nval master = \"kku.training.dimajix-aws.net\"\n\n// Connect to raw text stream socket using the DataStreamReader API via spark.readStream. You need to specify the options `host`, `port` and you need to use the format `socket`\nval lines = spark.readStream\n  .format(\"socket\")\n  .option(\"host\", master)\n  .option(\"port\", 9977)\n  .load()","dateUpdated":"2018-04-05T19:44:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"master: String = kku.training.dimajix-aws.net\nlines: org.apache.spark.sql.DataFrame = [value: string]\n"}]},"apps":[],"jobName":"paragraph_1522952584753_-1240615954","id":"20170218-160002_129671727","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7995","user":"anonymous","dateFinished":"2018-04-05T19:45:06+0000","dateStarted":"2018-04-05T19:44:28+0000"},{"text":"%md\n## 1.1 Inspect Schema\n\nThe result of the load method is a `DataFrame` again, but a streaming one. This `DataFrame` again has a schema, which we can inspect with the usual method:","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>1.1 Inspect Schema</h2>\n<p>The result of the load method is a <code>DataFrame</code> again, but a streaming one. This <code>DataFrame</code> again has a schema, which we can inspect with the usual method:</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584753_-1240615954","id":"20170218-161504_128762750","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:7996"},{"text":"lines.printSchema()","dateUpdated":"2018-04-05T19:44:36+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- value: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1522952584753_-1240615954","id":"20170218-160206_920542952","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7997","user":"anonymous","dateFinished":"2018-04-05T19:45:06+0000","dateStarted":"2018-04-05T19:44:36+0000"},{"text":"%md\n# 2. Inspect Data\n\nOf course we also want to inspect the data inside the DataFrame. But this time, we cannot simply invoke `show`, because normal actions do not (directly) work on streaming DataFrames. Instead we need to create a continiuous query. Later, we will see a neat trick how a streaming query can be transformed into a volatile table.\n\nIn order to create a continuous query, we need to perform the following steps\n\n1. Create a `DataStreamWriter` by using the `writeStream` method of a DataFrame\n2. Specify the output format. We use `console` in our case\n3. Specify a checkpoint location on HDFS. This is required for restarting\n4. Optionally specify a processing period\n5. Start the query\n6. For Zeppelin only: Sleep a little bit, or we miss the output","dateUpdated":"2018-04-05T18:56:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>2. Inspect Data</h1>\n<p>Of course we also want to inspect the data inside the DataFrame. But this time, we cannot simply invoke <code>show</code>, because normal actions do not (directly) work on streaming DataFrames. Instead we need to create a continiuous query. Later, we will see a neat trick how a streaming query can be transformed into a volatile table.</p>\n<p>In order to create a continuous query, we need to perform the following steps</p>\n<ol>\n<li>Create a <code>DataStreamWriter</code> by using the <code>writeStream</code> method of a DataFrame</li>\n<li>Specify the output format. We use <code>console</code> in our case</li>\n<li>Specify a checkpoint location on HDFS. This is required for restarting</li>\n<li>Optionally specify a processing period</li>\n<li>Start the query</li>\n<li>For Zeppelin only: Sleep a little bit, or we miss the output</li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1522952584754_-1239461707","id":"20170218-161603_528321172","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8001","user":"anonymous","dateFinished":"2018-04-05T18:56:52+0000","dateStarted":"2018-04-05T18:56:52+0000"},{"text":"import org.apache.spark.sql.streaming.ProcessingTime\n\nval query = lines.writeStream\n    .format(\"console\")\n    .outputMode(\"append\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-print\")\n    .start()\n    \nThread.sleep(30000)    ","dateUpdated":"2018-04-05T19:45:46+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.streaming.ProcessingTime\nquery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@4fc8e420\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n+--------------------+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 2\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 3\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 4\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 5\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 6\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 7\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 8\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 9\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 10\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 11\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 12\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 13\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 14\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 15\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 16\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 17\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 18\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n+--------------------+\n\n-------------------------------------------\nBatch: 19\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 20\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n-------------------------------------------\nBatch: 21\n-------------------------------------------\n+--------------------+\n|               value|\n+--------------------+\n|{\"delete\":{\"statu...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"delete\":{\"statu...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n|{\"created_at\":\"Fr...|\n+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1522952584754_-1239461707","id":"20170218-160132_1015574950","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8002","user":"anonymous","dateFinished":"2018-04-05T19:45:38+0000","dateStarted":"2018-04-05T19:45:06+0000"},{"text":"%md\n## 2.1 Stop Query\n\nIn contrast to the RDD API, we can simply stop an individual query instead of a whole StreamingContext by simply calling the `stop` method on the query object. This makes working with streams much easier.","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>2.1 Stop Query</h2>\n<p>In contrast to the RDD API, we can simply stop an individual query instead of a whole StreamingContext by simply calling the <code>stop</code> method on the query object. This makes working with streams much easier.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584755_-1239846456","id":"20170218-161746_736484246","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8003"},{"text":"query.stop","dateUpdated":"2018-04-05T19:45:47+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522952584755_-1239846456","id":"20170218-160155_661067655","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8004","user":"anonymous","dateFinished":"2018-04-05T19:45:48+0000","dateStarted":"2018-04-05T19:45:47+0000"},{"text":"%md\n# 3. Counting Hash-Tags\n\nSo we now want to create a streaming hashtag count. First we need to extract the Tweet itself from the JSON document, then we need to extract the hashtags in a similar way to the batch word traditional DataFrame word count example, i.e. we split every line into words, keep only hash-tags, group the words and count the sizes of the groups.\n\nEach query looks as follows\n\n```\n{ \"contributors\" : null,\n  \"coordinates\" : null,\n  \"created_at\" : \"Fri Jul 29 12:46:00 +0000 2016\",\n  \"entities\" : { \"hashtags\" : [  ],\n      \"symbols\" : [  ],\n      \"urls\" : [ { \"display_url\" : \"fb.me/ItnwZEhy\",\n            \"expanded_url\" : \"http://fb.me/ItnwZEhy\",\n            \"indices\" : [ 33,\n                56\n              ],\n            \"url\" : \"https://t.co/mM0if95F1K\"\n          } ],\n      \"user_mentions\" : [  ]\n    },\n  \"favorite_count\" : 0,\n  \"favorited\" : false,\n  \"filter_level\" : \"low\",\n  \"geo\" : null,\n  \"id\" : 759007065155117058,\n  \"id_str\" : \"759007065155117058\",\n  \"in_reply_to_screen_name\" : null,\n  \"in_reply_to_status_id\" : null,\n  \"in_reply_to_status_id_str\" : null,\n  \"in_reply_to_user_id\" : null,\n  \"in_reply_to_user_id_str\" : null,\n  \"is_quote_status\" : false,\n  \"lang\" : \"en\",\n  \"place\" : null,\n  \"possibly_sensitive\" : false,\n  \"retweet_count\" : 0,\n  \"retweeted\" : false,\n  \"source\" : \"<a href=\\\"http://www.facebook.com/twitter\\\" rel=\\\"nofollow\\\">Facebook</a>\",\n  \"text\" : \"I posted a new video to Facebook https://t.co/mM0if95F1K\",\n  \"timestamp_ms\" : \"1469796360659\",\n  \"truncated\" : false,\n  \"user\" : { \"contributors_enabled\" : false,\n      \"created_at\" : \"Sat Sep 08 08:28:55 +0000 2012\",\n      \"default_profile\" : false,\n      \"default_profile_image\" : false,\n      \"description\" : null,\n      \"favourites_count\" : 0,\n      \"follow_request_sent\" : null,\n      \"followers_count\" : 0,\n      \"following\" : null,\n      \"friends_count\" : 0,\n      \"geo_enabled\" : false,\n      \"id\" : 810489374,\n      \"id_str\" : \"810489374\",\n      \"is_translator\" : false,\n      \"lang\" : \"zh-tw\",\n      \"listed_count\" : 0,\n      \"location\" : null,\n      \"name\" : \"張冥閻\",\n      \"notifications\" : null,\n      \"profile_background_color\" : \"FFF04D\",\n      \"profile_background_image_url\" : \"http://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_image_url_https\" : \"https://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_tile\" : false,\n      \"profile_image_url\" : \"http://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_image_url_https\" : \"https://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_link_color\" : \"0099CC\",\n      \"profile_sidebar_border_color\" : \"FFF8AD\",\n      \"profile_sidebar_fill_color\" : \"F6FFD1\",\n      \"profile_text_color\" : \"333333\",\n      \"profile_use_background_image\" : true,\n      \"protected\" : false,\n      \"screen_name\" : \"nineemperor1\",\n      \"statuses_count\" : 9652,\n      \"time_zone\" : null,\n      \"url\" : null,\n      \"utc_offset\" : null,\n      \"verified\" : false\n    }\n}\n```\n\nIn order to extract a field from a JSON document, we can use the `get_json_object` function.","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>3. Counting Hash-Tags</h1>\n<p>So we now want to create a streaming hashtag count. First we need to extract the Tweet itself from the JSON document, then we need to extract the hashtags in a similar way to the batch word traditional DataFrame word count example, i.e. we split every line into words, keep only hash-tags, group the words and count the sizes of the groups.</p>\n<p>Each query looks as follows</p>\n<pre><code>{ \"contributors\" : null,\n  \"coordinates\" : null,\n  \"created_at\" : \"Fri Jul 29 12:46:00 +0000 2016\",\n  \"entities\" : { \"hashtags\" : [  ],\n      \"symbols\" : [  ],\n      \"urls\" : [ { \"display_url\" : \"fb.me/ItnwZEhy\",\n            \"expanded_url\" : \"http://fb.me/ItnwZEhy\",\n            \"indices\" : [ 33,\n                56\n              ],\n            \"url\" : \"https://t.co/mM0if95F1K\"\n          } ],\n      \"user_mentions\" : [  ]\n    },\n  \"favorite_count\" : 0,\n  \"favorited\" : false,\n  \"filter_level\" : \"low\",\n  \"geo\" : null,\n  \"id\" : 759007065155117058,\n  \"id_str\" : \"759007065155117058\",\n  \"in_reply_to_screen_name\" : null,\n  \"in_reply_to_status_id\" : null,\n  \"in_reply_to_status_id_str\" : null,\n  \"in_reply_to_user_id\" : null,\n  \"in_reply_to_user_id_str\" : null,\n  \"is_quote_status\" : false,\n  \"lang\" : \"en\",\n  \"place\" : null,\n  \"possibly_sensitive\" : false,\n  \"retweet_count\" : 0,\n  \"retweeted\" : false,\n  \"source\" : \"&lt;a href=\\\"http://www.facebook.com/twitter\\\" rel=\\\"nofollow\\\"&gt;Facebook&lt;/a&gt;\",\n  \"text\" : \"I posted a new video to Facebook https://t.co/mM0if95F1K\",\n  \"timestamp_ms\" : \"1469796360659\",\n  \"truncated\" : false,\n  \"user\" : { \"contributors_enabled\" : false,\n      \"created_at\" : \"Sat Sep 08 08:28:55 +0000 2012\",\n      \"default_profile\" : false,\n      \"default_profile_image\" : false,\n      \"description\" : null,\n      \"favourites_count\" : 0,\n      \"follow_request_sent\" : null,\n      \"followers_count\" : 0,\n      \"following\" : null,\n      \"friends_count\" : 0,\n      \"geo_enabled\" : false,\n      \"id\" : 810489374,\n      \"id_str\" : \"810489374\",\n      \"is_translator\" : false,\n      \"lang\" : \"zh-tw\",\n      \"listed_count\" : 0,\n      \"location\" : null,\n      \"name\" : \"張冥閻\",\n      \"notifications\" : null,\n      \"profile_background_color\" : \"FFF04D\",\n      \"profile_background_image_url\" : \"http://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_image_url_https\" : \"https://abs.twimg.com/images/themes/theme19/bg.gif\",\n      \"profile_background_tile\" : false,\n      \"profile_image_url\" : \"http://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_image_url_https\" : \"https://pbs.twimg.com/profile_images/378800000157469481/0a267258c8ccd1bf53d01c115677dbd7_normal.jpeg\",\n      \"profile_link_color\" : \"0099CC\",\n      \"profile_sidebar_border_color\" : \"FFF8AD\",\n      \"profile_sidebar_fill_color\" : \"F6FFD1\",\n      \"profile_text_color\" : \"333333\",\n      \"profile_use_background_image\" : true,\n      \"protected\" : false,\n      \"screen_name\" : \"nineemperor1\",\n      \"statuses_count\" : 9652,\n      \"time_zone\" : null,\n      \"url\" : null,\n      \"utc_offset\" : null,\n      \"verified\" : false\n    }\n}\n</code></pre>\n<p>In order to extract a field from a JSON document, we can use the <code>get_json_object</code> function.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584755_-1239846456","id":"20170218-161837_1521722724","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8005"},{"text":"%md\n## 3.1 Extract Tweet\n\nFirst we need to extract the tweet text itself via the `get_json_object` function and store it into a new column.","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.1 Extract Tweet</h2>\n<p>First we need to extract the tweet text itself via the <code>get_json_object</code> function and store it into a new column.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584756_-1241770200","id":"20170220-182415_1872492795","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8006"},{"text":"import org.apache.spark.sql.types._\n\nval ts_text = lines.select(\n        (get_json_object($\"value\", \"$.timestamp_ms\").cast(LongType) / lit(1000)).cast(TimestampType).as(\"ts\"),\n        get_json_object($\"value\", \"$.text\").as(\"text\")\n    )","dateUpdated":"2018-04-05T19:45:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\nts_text: org.apache.spark.sql.DataFrame = [ts: timestamp, text: string]\n"}]},"apps":[],"jobName":"paragraph_1522952584756_-1241770200","id":"20170218-160238_1475524112","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8007","user":"anonymous","dateFinished":"2018-04-05T19:45:55+0000","dateStarted":"2018-04-05T19:45:54+0000"},{"text":"%md\n## 3.2 Extract Topics\n\nNow that we have the Tweet text itself, we split it along spaces and extract all hash-tags.","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.2 Extract Topics</h2>\n<p>Now that we have the Tweet text itself, we split it along spaces and extract all hash-tags.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584756_-1241770200","id":"20170220-182404_1394954195","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8008"},{"text":"val topics = ts_text.select(ts_text(\"ts\"), explode(split(ts_text(\"text\"),\" \")).as(\"topic\"))\n    .filter($\"topic\".startsWith(\"#\"))\n    .filter($\"topic\" =!= \"#\")","dateUpdated":"2018-04-05T19:45:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"topics: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ts: timestamp, topic: string]\n"}]},"apps":[],"jobName":"paragraph_1522952584756_-1241770200","id":"20170220-180159_930749179","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8009","user":"anonymous","dateFinished":"2018-04-05T19:45:59+0000","dateStarted":"2018-04-05T19:45:58+0000"},{"text":"%md\n## 3.3 Count Topics\n\nNow that we have the hash tags (topics), we perform a simple aggregation as usual.","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.3 Count Topics</h2>\n<p>Now that we have the hash tags (topics), we perform a simple aggregation as usual.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584757_-1242154949","id":"20170220-182554_1623876741","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8010"},{"text":"val counts = topics\n    .groupBy(\"topic\")\n    .agg(sum(lit(1)).as(\"count\"))","dateUpdated":"2018-04-05T19:39:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"counts: org.apache.spark.sql.DataFrame = [topic: string, count: bigint]\n"}]},"apps":[],"jobName":"paragraph_1522952584757_-1242154949","id":"20170218-160526_2008806660","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8011","user":"anonymous","dateFinished":"2018-04-05T19:39:37+0000","dateStarted":"2018-04-05T19:39:37+0000"},{"text":"counts.printSchema","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- topic: string (nullable = true)\n |-- count: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1522952584757_-1242154949","id":"20170218-162308_1835168589","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8012"},{"text":"%md\n## 3.4 Print Results onto Console\n\nAgain we want to print the results onto the console.","dateUpdated":"2018-04-05T18:52:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3.4 Print Results onto Console</h2>\n<p>Again we want to print the results onto the console.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584757_-1242154949","id":"20170218-161041_735302634","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8013","user":"anonymous","dateFinished":"2018-04-05T18:52:03+0000","dateStarted":"2018-04-05T18:52:03+0000"},{"text":"val query = counts.writeStream\n    .format(\"console\")\n    .outputMode(\"complete\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-count\")\n    .start()\n    \nThread.sleep(20000)","dateUpdated":"2018-04-05T19:46:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"query: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@56325294\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n"}]},"apps":[],"jobName":"paragraph_1522952584758_-1241000703","id":"20170218-160613_988660270","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8014","user":"anonymous","dateFinished":"2018-04-05T19:41:53+0000","dateStarted":"2018-04-05T19:41:32+0000"},{"text":"query.stop()","dateUpdated":"2018-04-05T19:41:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522952584758_-1241000703","id":"20170218-160716_194527039","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8015","user":"anonymous","dateFinished":"2018-04-05T19:41:58+0000","dateStarted":"2018-04-05T19:41:57+0000"},{"text":"%md\n# 4. Time-Windowed Aggregation\n\nAnother interesting (and probably more realistic) application is to perform time windowed aggregations. This means that we define a sliding time window used in the `groupBy` clause. In addition we also define a so called *watermark* which tells Spark how long to wait for late arrivels of individual data points (we don't have them in our simple example).","dateUpdated":"2018-04-05T18:52:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>4. Time-Windowed Aggregation</h1>\n<p>Another interesting (and probably more realistic) application is to perform time windowed aggregations. This means that we define a sliding time window used in the <code>groupBy</code> clause. In addition we also define a so called <em>watermark</em> which tells Spark how long to wait for late arrivels of individual data points (we don't have them in our simple example).</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584758_-1241000703","id":"20170218-164639_1471935006","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8016","user":"anonymous","dateFinished":"2018-04-05T18:52:20+0000","dateStarted":"2018-04-05T18:52:20+0000"},{"text":"val windowedCounts = topics\n    .withWatermark(\"ts\", \"10 seconds\")\n    .groupBy(window($\"ts\", \"5 seconds\", \"1 seconds\"), $\"topic\")\n    .agg(sum(lit(1)).as(\"count\"))","dateUpdated":"2018-04-05T19:46:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"windowedCounts: org.apache.spark.sql.DataFrame = [window: struct<start: timestamp, end: timestamp>, topic: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1522952584758_-1241000703","id":"20170218-164703_2039341008","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8017","user":"anonymous","dateFinished":"2018-04-05T19:46:09+0000","dateStarted":"2018-04-05T19:46:09+0000"},{"text":"windowedCounts.printSchema()","dateUpdated":"2018-04-05T18:23:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- window: struct (nullable = true)\n |    |-- start: timestamp (nullable = true)\n |    |-- end: timestamp (nullable = true)\n |-- topic: string (nullable = true)\n |-- count: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1522952584758_-1241385452","id":"20170218-165357_1483843188","dateCreated":"2018-04-05T18:23:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8018"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522955404137_771711094","id":"20180405-191004_1783341391","dateCreated":"2018-04-05T19:10:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11445","text":"%md\n## 4.1 Output Data\n\nLet's again output the data. This time, we also like to investigate the different output modes `append`, `complete` and `update`.","dateUpdated":"2018-04-05T19:12:46+0000","dateFinished":"2018-04-05T19:12:46+0000","dateStarted":"2018-04-05T19:12:46+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4.1 Output Data</h2>\n<p>Let's again output the data. This time, we also like to investigate the different output modes <code>append</code>, <code>complete</code> and <code>update</code>.</p>\n"}]}},{"text":"val query = windowedCounts.writeStream\n    .outputMode(\"update\")\n    .format(\"console\")\n    .trigger(ProcessingTime(\"1 seconds\"))\n    .queryName(\"topic_counts\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-console-2\")\n    .start()    \n    \nThread.sleep(60000)\n\nquery.stop()","dateUpdated":"2018-04-05T19:46:14+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522952584761_-1243693945","id":"20170218-162247_324928954","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8025","user":"anonymous","dateFinished":"2018-04-05T19:47:15+0000","dateStarted":"2018-04-05T19:46:14+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nquery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@6130fe10\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+--------------------+-----------+-----+\n|              window|      topic|count|\n+--------------------+-----------+-----+\n|[2016-07-29 08:01...|      #AWTU|    1|\n|[2016-07-29 08:01...|     #AOMG…|    1|\n|[2016-07-29 08:01...|      #AWTU|    1|\n|[2016-07-29 08:01...|     #AOMG…|    1|\n|[2016-07-29 08:01...|      #free|    1|\n|[2016-07-29 08:01...|#NowPlaying|    1|\n|[2016-07-29 08:01...|     #AOMG…|    1|\n|[2016-07-29 08:01...|      #free|    1|\n|[2016-07-29 08:01...|#NowPlaying|    1|\n|[2016-07-29 08:01...|      #free|    1|\n|[2016-07-29 08:01...|      #free|    1|\n|[2016-07-29 08:01...|#NowPlaying|    1|\n|[2016-07-29 08:01...|     #AOMG…|    1|\n|[2016-07-29 08:01...|      #free|    1|\n|[2016-07-29 08:01...|      #AWTU|    1|\n|[2016-07-29 08:01...|     #AOMG…|    1|\n|[2016-07-29 08:01...|      #AWTU|    1|\n|[2016-07-29 08:01...|#NowPlaying|    1|\n|[2016-07-29 08:01...|      #AWTU|    1|\n|[2016-07-29 08:01...|#NowPlaying|    1|\n+--------------------+-----------+-----+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...|             #rakday|    1|\n|[2016-07-29 08:01...|#hiltonalhamrabea...|    1|\n|[2016-07-29 08:01...|        #OnlineStore|    1|\n|[2016-07-29 08:01...|            #sexting|    1|\n|[2016-07-29 08:01...|               #slag|    1|\n|[2016-07-29 08:01...|             #rakday|    1|\n|[2016-07-29 08:01...|#hiltonalhamrabea...|    1|\n|[2016-07-29 08:01...|            #sexting|    1|\n|[2016-07-29 08:01...|       #Baseball.FAQ|    1|\n|[2016-07-29 08:01...|                  #W|    1|\n|[2016-07-29 08:01...|#DolceAmoreSabota...|    2|\n|[2016-07-29 08:01...|            #Shopify|    1|\n|[2016-07-29 08:01...|                #cam|    1|\n|[2016-07-29 08:01...|#hiltonalhamrabea...|    1|\n|[2016-07-29 08:01...|               #slag|    1|\n|[2016-07-29 08:01...|   #CPEC_GameChanger|    1|\n|[2016-07-29 08:01...|              #Quran|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|    5|\n|[2016-07-29 08:01...|                  #W|    1|\n|[2016-07-29 08:01...|           #ForGlory|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 2\n-------------------------------------------\n+--------------------+-------------------+-----+\n|              window|              topic|count|\n+--------------------+-------------------+-----+\n|[2016-07-29 08:01...|        #Quote\nWhen|    1|\n|[2016-07-29 08:01...|               #art|    1|\n|[2016-07-29 08:01...|              #MUFC|    1|\n|[2016-07-29 08:01...|           #Destiny|    1|\n|[2016-07-29 08:01...|          #painting|    2|\n|[2016-07-29 08:01...|                 #B|    1|\n|[2016-07-29 08:01...|  #KolkataHospitals|    1|\n|[2016-07-29 08:01...|           #Destiny|    1|\n|[2016-07-29 08:01...|        #Quote\nWhen|    1|\n|[2016-07-29 08:01...|  #KolkataHospitals|    1|\n|[2016-07-29 08:01...|#PushAwardsLizQuens|    8|\n|[2016-07-29 08:01...| #MicrosoftDynamics|    1|\n|[2016-07-29 08:01...| #BlackWomenDidThat|    1|\n|[2016-07-29 08:01...|#Behind_the_scenes\n|    1|\n|[2016-07-29 08:01...| #BlackWomenDidThat|    1|\n|[2016-07-29 08:01...| #رابطه_عشاق_القهوه|    1|\n|[2016-07-29 08:01...|               #art|    1|\n|[2016-07-29 08:01...|               #몬채널|    1|\n|[2016-07-29 08:01...|#PushAwardsLizQuens|   14|\n|[2016-07-29 08:01...|#PushAwardsLizQuens|   14|\n+--------------------+-------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 3\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...|         #Derbyshire|    1|\n|[2016-07-29 08:01...|            #Samples|    1|\n|[2016-07-29 08:01...|              #プレゼント|    1|\n|[2016-07-29 08:01...|  #NationalParksWeek|    1|\n|[2016-07-29 08:01...|        #conceptdraw|    1|\n|[2016-07-29 08:01...|            #Science|    1|\n|[2016-07-29 08:01...|            #Samples|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|    9|\n|[2016-07-29 08:01...|        #conceptdraw|    1|\n|[2016-07-29 08:01...|        #gidinigeria|    1|\n|[2016-07-29 08:01...|#VendrediLecture\n\nEn|    1|\n|[2016-07-29 08:01...|          #Education|    1|\n|[2016-07-29 08:01...|           #bakewell|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   15|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    1|\n|[2016-07-29 08:01...|                 #ギア|    1|\n|[2016-07-29 08:01...|               #sale|    1|\n|[2016-07-29 08:01...|               #sale|    1|\n|[2016-07-29 08:01...|            #Science|    1|\n|[2016-07-29 08:01...|  #NationalParksWeek|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 4\n-------------------------------------------\n+--------------------+-------------------+-----+\n|              window|              topic|count|\n+--------------------+-------------------+-----+\n|[2016-07-29 08:01...|           #Samples|    2|\n|[2016-07-29 08:01...|              #Obra|    1|\n|[2016-07-29 08:01...|         #lockherup|    1|\n|[2016-07-29 08:01...|        #balenciaga|    1|\n|[2016-07-29 08:01...| #electricalservice|    1|\n|[2016-07-29 08:01...|           #Science|    2|\n|[2016-07-29 08:01...|           #Samples|    2|\n|[2016-07-29 08:01...|          #Shillary|    1|\n|[2016-07-29 08:01...|#PushAwardsLizQuens|    6|\n|[2016-07-29 08:01...|           #Reforma|    1|\n|[2016-07-29 08:01...|       #ทรงพระเจริญ|    1|\n|[2016-07-29 08:01...|#PushAwardsLizQuens|   15|\n|[2016-07-29 08:01...|    #knights_60mins|    1|\n|[2016-07-29 08:01...|         #lockherup|    1|\n|[2016-07-29 08:01...|           #auction|    1|\n|[2016-07-29 08:01...|           #Reforma|    1|\n|[2016-07-29 08:01...|           #Reforma|    1|\n|[2016-07-29 08:01...|         #Education|    2|\n|[2016-07-29 08:01...|     #ALDUBSafeZone|    1|\n|[2016-07-29 08:00...|       #ทรงพระเจริญ|    1|\n+--------------------+-------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 5\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...|             #الجمعه|    1|\n|[2016-07-29 08:01...|             #الجمعه|    1|\n|[2016-07-29 08:01...|         #يوم_الجمعة|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|    7|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   16|\n|[2016-07-29 08:01...|             #الجمعه|    1|\n|[2016-07-29 08:01...|#SientoMuchoMiedo...|    1|\n|[2016-07-29 08:01...|        #BTSinMANILA|    1|\n|[2016-07-29 08:01...|         #يوم_الجمعه|    1|\n|[2016-07-29 08:01...|#SientoMuchoMiedo...|    1|\n|[2016-07-29 08:01...|         #يوم_الجمعه|    1|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    8|\n|[2016-07-29 08:01...|           #SevereWX|    1|\n|[2016-07-29 08:01...|           #SevereWX|    1|\n|[2016-07-29 08:01...|        #BTSinMANILA|    1|\n|[2016-07-29 08:01...|          #เสียงสู๊ง|    1|\n|[2016-07-29 08:01...|#SientoMuchoMiedo...|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|    7|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    7|\n|[2016-07-29 08:01...|          #เสียงสู๊ง|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 6\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   10|\n|[2016-07-29 08:01...|            #المهاجر|    1|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    3|\n|[2016-07-29 08:01...|            #Virtual|    1|\n|[2016-07-29 08:01...|            #Virtual|    1|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|   11|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   10|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|   10|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    3|\n|[2016-07-29 08:01...|            #shopper|    1|\n|[2016-07-29 08:01...|            #shopper|    1|\n|[2016-07-29 08:01...|            #shopper|    1|\n|[2016-07-29 08:01...|            #shopper|    1|\n|[2016-07-29 08:01...|#DolceAmoreSabota...|    1|\n|[2016-07-29 08:01...|#DolceAmoreSabota...|    1|\n|[2016-07-29 08:01...|#DolceAmoreSabota...|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   11|\n|[2016-07-29 08:01...|            #المهاجر|    1|\n|[2016-07-29 08:01...|            #المهاجر|    1|\n|[2016-07-29 08:01...|            #Virtual|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 7\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...|  #메이저놀이터\n#네임드사다리사이트|    1|\n|[2016-07-29 08:01...|                #win|    1|\n|[2016-07-29 08:01...|#أذكار_الصباح_وال...|    1|\n|[2016-07-29 08:01...|             #follow|    1|\n|[2016-07-29 08:01...|      #curacao\n\nNice|    1|\n|[2016-07-29 08:01...|               #comp|    1|\n|[2016-07-29 08:01...|            #ニューオープン|    1|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   19|\n|[2016-07-29 08:01...|           #loveweek|    1|\n|[2016-07-29 08:01...|           #loveweek|    1|\n|[2016-07-29 08:01...|               #free|    1|\n|[2016-07-29 08:01...|             #winner|    1|\n|[2016-07-29 08:01...|                 #rt|    1|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    3|\n|[2016-07-29 08:01...|        #competition|    1|\n|[2016-07-29 08:01...|             #winner|    1|\n|[2016-07-29 08:01...|                 #rt|    1|\n|[2016-07-29 08:01...|           #loveweek|    1|\n|[2016-07-29 08:01...|      #curacao\n\nNice|    1|\n|[2016-07-29 08:01...|              #美容師求人|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 8\n-------------------------------------------\n+--------------------+--------------------+-----+\n|              window|               topic|count|\n+--------------------+--------------------+-----+\n|[2016-07-29 08:01...|               #エルフ耳|    1|\n|[2016-07-29 08:01...|         #MTVHottest|    1|\n|[2016-07-29 08:01...|                 #ポー|    1|\n|[2016-07-29 08:01...|       #haveagoodday|    1|\n|[2016-07-29 08:01...|              #Women|    1|\n|[2016-07-29 08:01...|             #こだまちゃん|    1|\n|[2016-07-29 08:01...|#アイドル\n\nhttps://t....|    1|\n|[2016-07-29 08:01...|                #居酒屋|    1|\n|[2016-07-29 08:01...|       #Crowdfunding|    1|\n|[2016-07-29 08:01...|      #itstheweekend|    1|\n|[2016-07-29 08:01...|         #POWのポストカード|    1|\n|[2016-07-29 08:01...|       #WhatIsMorgan|    1|\n|[2016-07-29 08:01...|#アイドル\n\nhttps://t....|    1|\n|[2016-07-29 08:01...|#アイドル\n\nhttps://t....|    1|\n|[2016-07-29 08:01...|               #フガフガ|    1|\n|[2016-07-29 08:01...| #DolceAmoreSabotage|    4|\n|[2016-07-29 08:01...| #PushAwardsLizQuens|   17|\n|[2016-07-29 08:01...|                #居酒屋|    1|\n|[2016-07-29 08:01...|         #MTVHottest|    1|\n|[2016-07-29 08:01...|              #balls|    1|\n+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n-------------------------------------------\nBatch: 9\n-------------------------------------------\n"}]},"focus":true},{"text":"%md\n## 5 Create Dynamic Table\n\nWe can also use a \"memory\" output, which is a queryable live table. In order to do so, we again create a new table, but this time with format `memory` and an explicit query name `topic_counts`. Using a `memory` output will create a dynamic table in memory (only `complete` output supported right now), which can be queried using SQL.\n\n1. Create a DataStreamWriter object using the writeStream method of your DataFrame `windowedCounts`.\n2. Set the format to `memory`\n3. Set the output mode to `append` (this is supported for time windowed aggregations)\n4. Set the query name to `topic_counts`\n5. Specify a checkPointLocation on HDFS (ok, this is not trivial, so it is in the code below)\n6. Start the continuous query via `start`","dateUpdated":"2018-04-05T19:10:25+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5 Create Dynamic Table</h2>\n<p>We can also use a &ldquo;memory&rdquo; output, which is a queryable live table. In order to do so, we again create a new table, but this time with format <code>memory</code> and an explicit query name <code>topic_counts</code>. Using a <code>memory</code> output will create a dynamic table in memory (only <code>complete</code> output supported right now), which can be queried using SQL.</p>\n<ol>\n<li>Create a DataStreamWriter object using the writeStream method of your DataFrame <code>windowedCounts</code>.</li>\n<li>Set the format to <code>memory</code></li>\n<li>Set the output mode to <code>append</code> (this is supported for time windowed aggregations)</li>\n<li>Set the query name to <code>topic_counts</code></li>\n<li>Specify a checkPointLocation on HDFS (ok, this is not trivial, so it is in the code below)</li>\n<li>Start the continuous query via <code>start</code></li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1522952584759_-1241385452","id":"20170218-160934_1425298948","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8019","user":"anonymous","dateFinished":"2018-04-05T19:10:25+0000","dateStarted":"2018-04-05T19:10:25+0000"},{"text":"val tableQuery = windowedCounts.writeStream\n    .outputMode(\"append\")\n    .format(\"memory\")\n    .trigger(ProcessingTime(\"1 seconds\"))\n    .queryName(\"topic_counts\")\n    .option(\"checkpointLocation\", \"/tmp/zeppelin/checkpoint-twitter-table\")\n    .start()","dateUpdated":"2018-04-05T19:05:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tableQuery: org.apache.spark.sql.streaming.StreamingQuery = org.apache.spark.sql.execution.streaming.StreamingQueryWrapper@62be4d17\n"}]},"apps":[],"jobName":"paragraph_1522952584759_-1241385452","id":"20170218-161145_208429016","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8020","user":"anonymous","dateFinished":"2018-04-05T19:01:17+0000","dateStarted":"2018-04-05T19:01:17+0000"},{"text":"%md\n## 5.1 Perform Query\n\nNow that we have a dynamic table, we can perform SQL queries against this table as if it was a normal static table.","dateUpdated":"2018-04-05T19:10:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5.1 Perform Query</h2>\n<p>Now that we have a dynamic table, we can perform SQL queries against this table as if it was a normal static table.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584759_-1241385452","id":"20170218-162010_1110788275","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8021","user":"anonymous","dateFinished":"2018-04-05T19:10:32+0000","dateStarted":"2018-04-05T19:10:32+0000"},{"text":"%sql\nselect \n    * \nfrom topic_counts\norder by count desc\nlimit 10","dateUpdated":"2018-04-05T19:02:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"window","index":0,"aggr":"sum"}],"values":[{"name":"topic","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"window","index":0,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{"language":"sql","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"window\ttopic\tcount\n[2018-04-05 19:01:17.0,2018-04-05 19:01:22.0]\t#DolceAmoreSabotage\t5\n[2018-04-05 19:01:18.0,2018-04-05 19:01:23.0]\t#DolceAmoreSabotage\t5\n[2018-04-05 19:01:16.0,2018-04-05 19:01:21.0]\t#DolceAmoreSabotage\t4\n[2018-04-05 19:01:15.0,2018-04-05 19:01:20.0]\t#DolceAmoreSabotage\t3\n[2018-04-05 19:01:16.0,2018-04-05 19:01:21.0]\t#PushAwardsLizQuens\t3\n[2018-04-05 19:01:15.0,2018-04-05 19:01:20.0]\t#PushAwardsLizQuens\t3\n[2018-04-05 19:01:18.0,2018-04-05 19:01:23.0]\t#PushAwardsLizQuens\t3\n[2018-04-05 19:01:17.0,2018-04-05 19:01:22.0]\t#PushAwardsLizQuens\t3\n[2018-04-05 19:01:19.0,2018-04-05 19:01:24.0]\t#DolceAmoreSabotage\t3\n[2018-04-05 19:01:14.0,2018-04-05 19:01:19.0]\t#DolceAmoreSabotage\t2\n"}]},"apps":[],"jobName":"paragraph_1522952584760_-1243309196","id":"20170218-161337_1103351127","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8022","user":"anonymous","dateFinished":"2018-04-05T19:02:05+0000","dateStarted":"2018-04-05T19:02:04+0000"},{"text":"%md\n## 5.2 Stop Query\n\nIn order to clean everything up, we stop the query again.","dateUpdated":"2018-04-05T19:10:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5.2 Stop Query</h2>\n<p>In order to clean everything up, we stop the query again.</p>\n"}]},"apps":[],"jobName":"paragraph_1522952584760_-1243309196","id":"20170218-162048_842521010","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8023","user":"anonymous","dateFinished":"2018-04-05T19:10:39+0000","dateStarted":"2018-04-05T19:10:39+0000"},{"text":"tableQuery.stop()","dateUpdated":"2018-04-05T19:02:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":[],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522952584760_-1243309196","id":"20170218-161329_1844676678","dateCreated":"2018-04-05T18:23:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8024","user":"anonymous","dateFinished":"2018-04-05T19:02:23+0000","dateStarted":"2018-04-05T19:02:23+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522955038099_-516581465","id":"20180405-190358_1697918875","dateCreated":"2018-04-05T19:03:58+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11241"}],"name":"Twitter Structured Streaming - Full","id":"2DBNHVR45","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}