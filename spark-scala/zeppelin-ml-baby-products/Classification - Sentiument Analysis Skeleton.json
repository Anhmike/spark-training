{"paragraphs":[{"text":"%md\n# Load Data\n\nFirst we load data from HDFS or S3. It is stored as a trivial CSV file with three columns\n\n* product name\n* review text\n* rating (1 - 5)\n\nWe will explicitly specify a Schema, because the CSV might not contain a valid header. Moreover this keeps us in detailed control over the column types and saves us from one Spark run trying to guess the types. ","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Load Data</h1>\n<p>First we load data from HDFS or S3. It is stored as a trivial CSV file with three columns</p>\n<ul>\n<li>product name</li>\n<li>review text</li>\n<li>rating (1 - 5)</li>\n</ul>\n<p>We will explicitly specify a Schema, because the CSV might not contain a valid header. Moreover this keeps us in detailed control over the column types and saves us from one Spark run trying to guess the types.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924746_-1029032413","id":"20170129-041356_575741458","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:16702"},{"text":"val basedir = \"file:///home/cloudera/Training/data/\"\n//val basedir = \"s3://dimajix-training/data/\"","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nbasedir: String = file:///home/cloudera/Training/data/\n"}]},"apps":[],"jobName":"paragraph_1520692924753_-1020952686","id":"20170129-045843_673583787","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16703"},{"text":"import org.apache.spark.sql.types.StructType\nimport org.apache.spark.sql.types.StructField\nimport org.apache.spark.sql.types.StringType\nimport org.apache.spark.sql.types.IntegerType\nimport org.apache.spark.sql.functions.col\n\n// Explicitly build the schema as we expect it in the CSV file. Note that we also assume \"rating\" to be string type. This saves\n// us from errors due to wrong entries. Casting a String to something else later only produces SQL NULL values, but no errors.\nval schema = StructType(\n        StructField(\"name\", StringType) ::\n        StructField(\"review\", StringType) ::\n        StructField(\"rating\", StringType) ::\n        Nil\n    )\n// Read in CSV data and cast rating column to integer    \nval csvdata = sqlContext.read\n    .schema(schema)\n    .csv(basedir + \"amazon_baby\")\n    .withColumn(\"rating\", col(\"rating\").cast(IntegerType))\n    .filter(col(\"rating\").isNotNull)\nz.show(csvdata.limit(10))","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":230.36666870117188,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[{"name":"review","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"},"yAxis":{"name":"review","index":1,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"name\treview\trating\nPlanetwise Flannel Wipes\tThese flannel wipes are OK, but in my opinion not worth keeping.  I also ordered someImse Vimse Cloth Wipes-Ocean Blue-12 countwhich are larger, had a nicer, softer texture and just seemed higher quality.  I use cloth wipes for hands and faces and have been usingThirsties 6 Pack Fab Wipes, Boyfor about 8 months now and need to replace them because they are starting to get rough and have had stink issues for a while that stripping no longer handles.\t3\nPlanetwise Wipe Pouch\tit came early and was not disappointed. i love planet wise bags and now my wipe holder. it keps my osocozy wipes moist and does not leak. highly recommend it.\t5\nAnnas Dream Full Quilt with 2 Shams\tVery soft and comfortable and warmer than it looks...fit the full size bed perfectly...would recommend to anyone looking for this type of quilt\t5\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tThis is a product well worth the purchase.  I have not found anything else like this, and it is a positive, ingenious approach to losing the binky.  What I love most about this product is how much ownership my daughter has in getting rid of the binky.  She is so proud of herself, and loves her little fairy.  I love the artwork, the chart in the back, and the clever approach of this tool.\t5\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tAll of my kids have cried non-stop when I tried to ween them off their pacifier, until I found Thumbuddy To Love's Binky Fairy Puppet.  It is an easy way to work with your kids to allow them to understand where their pacifier is going and help them part from it.This is a must buy book, and a great gift for expecting parents!!  You will save them soo many headaches.Thanks for this book!  You all rock!!\t5\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tWhen the Binky Fairy came to our house, we didn't have any special gift and book to help explain to her about how important it is to stop using a pacifier. This book does a great job to help prepare your child for the loss of their favorite item. The doll is adorable and we made lots of cute movies with the Binky Fairy telling our daughter about what happens when the Binky Fairy comes. I would highly recommend this product for any parent trying to break the pacifier or thumb sucking habit.\t5\nA Tale of Baby's Days with Peter Rabbit\tLovely book, it's bound tightly so you may not be able to add alot of photos/cards aside from the designated spaces in the book. Shop around before you purchase, as it is currently listed at Barnes & Noble for 29.95!\t4\nBaby Tracker&reg; - Daily Childcare Journal, Schedule Log\tPerfect for new parents. We were able to keep track of baby's feeding, sleep and diaper change schedule for the first two and a half months of her life. Made life easier when the doctor would ask questions about habits because we had it all right there!\t5\nBaby Tracker&reg; - Daily Childcare Journal, Schedule Log\tA friend of mine pinned this product on Pinterest so I decided to give it a whirl! It is fantastic! If you are a new parent, this will help you keep track of feedings, diaper changes and the like!\t5\nBaby Tracker&reg; - Daily Childcare Journal, Schedule Log\tThis has been an easy way for my nanny to record all the key events that happen with my baby when I'm not at home.  Would highly recommend it to someone who wants to stay informed of what your baby is up to while you're not home.The only reason this isn't a 5 is because I think there could have been some more standarad pre-printed options.I plan on ordering another one when we run out of pages in this journal.\t4\n"}]},"apps":[],"jobName":"paragraph_1520692924753_-1020952686","id":"20170129-041420_2034427172","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16704"},{"text":"%md\n# Extract Features from raw data\n\nWe want to train a logistic regression for predicting the sentiment of a product review given its text. Since a logistic regression does not directly work with text, we need to extract some numeric features from the data.\n\nWe will perform the two following extractions, one for the label to be binary and a multi-step extraction for the features.\n\n1. Extract binary sentiment from given review value\n2. Extract bag-of-words model as features","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Extract Features from raw data</h1>\n<p>We want to train a logistic regression for predicting the sentiment of a product review given its text. Since a logistic regression does not directly work with text, we need to extract some numeric features from the data.</p>\n<p>We will perform the two following extractions, one for the label to be binary and a multi-step extraction for the features.</p>\n<ol>\n<li>Extract binary sentiment from given review value</li>\n<li>Extract bag-of-words model as features</li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1520692924753_-1020952686","id":"20170129-052423_858609389","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16705"},{"text":"%md\n## 1. Extract Sentiment\n\nSince we want to perform a classification (positive review vs negative review), we need to extract a binary sentiment value. We will map the ratings as follows:\n\n* Ratings 1 and 2 count as a negative review\n* Rating 3 counts as a neutral review\n* Ratings 4 and 5 count as a positive review\n\nSince we want a binary classification, we will also remove neutral reviews altogether.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>1. Extract Sentiment</h2>\n<p>Since we want to perform a classification (positive review vs negative review), we need to extract a binary sentiment value. We will map the ratings as follows:</p>\n<ul>\n<li>Ratings 1 and 2 count as a negative review</li>\n<li>Rating 3 counts as a neutral review</li>\n<li>Ratings 4 and 5 count as a positive review</li>\n</ul>\n<p>Since we want a binary classification, we will also remove neutral reviews altogether.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924756_-1022106933","id":"20170129-042008_1516671555","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16706"},{"text":"// YOUR CODE HERE\nval data = ...","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924756_-1022106933","id":"20170129-042350_2056232695","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16707"},{"text":"%md\n## 2. Extract Features from Reviews\n\nNow we want to split the review text into individual words, so we can create a \"bag of words\" model. In order to get a somewhat nice model, we also need to remove all punctuations from the reviews.\n\n### 2.1. Remove Punctuations\nSo the first step is to remove all puncuations.  This will be done as the first step using a user defined function (UDF) in Spark, which will simply replace any punctuation character by a space.","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>2. Extract Features from Reviews</h2>\n<p>Now we want to split the review text into individual words, so we can create a &ldquo;bag of words&rdquo; model. In order to get a somewhat nice model, we also need to remove all punctuations from the reviews.</p>\n<h3>2.1. Remove Punctuations</h3>\n<p>So the first step is to remove all puncuations.  This will be done as the first step using a user defined function (UDF) in Spark, which will simply replace any punctuation character by a space.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924756_-1022106933","id":"20170129-043924_1480728312","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16708"},{"text":"import org.apache.spark.sql.functions.udf\n\nval removePunctuation = udf { text:String => text.replaceAll(\"\\\\p{Punct}\", \" \") }\n// YOUR CODE HERE\nval data2 = ...","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924757_-1022491681","id":"20170129-043943_507827673","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16709"},{"text":"%md\n### 2.2 Split Reviews into Words\n\nNow we want to split every review into multiple words, resulting in a new data column containing an array with all words of the review. We could do that ourselves using some Scala methods, but we use a Transformer provided by Spark instead. Saves us some time and helps to create clean code.\n\nSpark ML contains a whole bunch of Transformers for extracting features. You can find them in the `org.apache.spark.ml.feature` package. Each Transformer accepts some parameters for specifying the details of the transformation. In particular most Transformers know about an input column and and output column which can be set via `setInputCol` and `setOutputCol`.\n\nOur specific task for splitting a string column into an array column with individual words can be performed with the `Tokenizer` Transform.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>2.2 Split Reviews into Words</h3>\n<p>Now we want to split every review into multiple words, resulting in a new data column containing an array with all words of the review. We could do that ourselves using some Scala methods, but we use a Transformer provided by Spark instead. Saves us some time and helps to create clean code.</p>\n<p>Spark ML contains a whole bunch of Transformers for extracting features. You can find them in the <code>org.apache.spark.ml.feature</code> package. Each Transformer accepts some parameters for specifying the details of the transformation. In particular most Transformers know about an input column and and output column which can be set via <code>setInputCol</code> and <code>setOutputCol</code>.</p>\n<p>Our specific task for splitting a string column into an array column with individual words can be performed with the <code>Tokenizer</code> Transform.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924757_-1022491681","id":"20170129-043958_121242280","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16710"},{"text":"import org.apache.spark.ml.feature.Tokenizer\n\n// YOUR CODE HERE\nval tokenizer = ...\nval words = tokenizer.transform(data2)","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[{"name":"review","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"},"yAxis":{"name":"review","index":1,"aggr":"sum"}}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924757_-1022491681","id":"20170129-044010_2048325285","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16711"},{"text":"%md\n### 2.3 Remove Stop words\n\nWe also want to remove so called stop words, which are all those tiny words which mainly serve as glue for building sentences. Usually they do not contain much information in a simple bag of words model. So we get rid of them.\n\nThis is so common practice that Spark already contains a `StopWordsRemover` Transformer class for just doing that. Again we need to specify some parameters like `inputCol`, `outputCol` and `stopWords`.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>2.3 Remove Stop words</h3>\n<p>We also want to remove so called stop words, which are all those tiny words which mainly serve as glue for building sentences. Usually they do not contain much information in a simple bag of words model. So we get rid of them.</p>\n<p>This is so common practice that Spark already contains a <code>StopWordsRemover</code> Transformer class for just doing that. Again we need to specify some parameters like <code>inputCol</code>, <code>outputCol</code> and <code>stopWords</code>.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924757_-1022491681","id":"20170129-044024_1653567754","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16712"},{"text":"val stopWords = Array(\"the\",\"a\",\"and\",\"or\", \"it\", \"this\", \"of\", \"an\", \"as\", \"in\", \"on\", \"is\", \"are\", \"to\", \"was\", \"for\", \"then\", \"i\", \"my\", \"that\", \"with\", \"we\", \"have\", \"so\", \"you\", \"s\", \"\")\n    \n// YOUR CODE HERE\nval stopWordsRemover = ...\nval vwords = stopWordsRemover.transform(words)","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924757_-1022491681","id":"20170129-044037_1562436005","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16713"},{"text":"%md\nNow lets have a look at common words. Maybe we want to change the list of stop words?","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Now lets have a look at common words. Maybe we want to change the list of stop words?</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924758_-1021337435","id":"20170129-103148_909017422","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16714"},{"text":"// YOUR CODE HERE\nval term_freq = ...\n\nz.show(term_freq.orderBy(col(\"count\").desc).limit(10))","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"word","index":0,"aggr":"sum"}],"values":[{"name":"count","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"word","index":0,"aggr":"sum"},"yAxis":{"name":"count","index":1,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"word\tcount\nbut\t87326\nt\t84871\ns\t75227\nnot\t73570\nbaby\t64630\nthey\t61610\none\t60035\nvery\t57412\nwhen\t52551\ngreat\t52288\n"}]},"apps":[],"jobName":"paragraph_1520692924758_-1021337435","id":"20170129-103147_26603517","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16715"},{"text":"%md\n### 2.4 Create Bag of Words Features\n\nFinally we simply count the number of occurances of all words within the reviews. Again we can simply use a `CountVectorizer` Transformer from the `org.apache.spark.ml.feature` package in Spark to perform that task. Again we need to specify `inputCol` and `outputCol`. Additionally we require that each word appears in at least two documents, to ensure some basic significance and avoid fitting the sentiment of a document onto single words.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>2.4 Create Bag of Words Features</h3>\n<p>Finally we simply count the number of occurances of all words within the reviews. Again we can simply use a <code>CountVectorizer</code> Transformer from the <code>org.apache.spark.ml.feature</code> package in Spark to perform that task. Again we need to specify <code>inputCol</code> and <code>outputCol</code>. Additionally we require that each word appears in at least two documents, to ensure some basic significance and avoid fitting the sentiment of a document onto single words.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924758_-1021337435","id":"20170129-044054_945211724","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16716"},{"text":"import org.apache.spark.ml.feature.CountVectorizer\n\n// YOUR CODE HERE\nval countVectorizer = ...\n\nval countVectorizerModel = countVectorizer.fit(vwords)","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924758_-1021337435","id":"20170129-044111_370443742","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16717"},{"text":"%md\n### 2.4 Bag of Words - Inspect Vocabulary\n\nThe countVectorizerModel contains an implcit vocabulary containing all words. This can be useful for mapping features back to words\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>2.4 Bag of Words - Inspect Vocabulary</h3>\n<p>The countVectorizerModel contains an implcit vocabulary containing all words. This can be useful for mapping features back to words</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924761_-1024030677","id":"20170129-044132_249596213","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16718"},{"text":"// YOUR CODE HERE","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924766_-1024415426","id":"20170129-044143_1368822013","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16719"},{"text":"%md\n### 2.5 Tidy up DataFrame\n\nWe now carry so many columns inside the DataFrame, let's remove some intermediate columns to get more focus on our model. In particular we remove the following columns:\n* `words`\n* `rating`\n \nWe keep the columns `review`, `name`, `sentiment` and `features`. For the model itself, we do not need `review` and `vwords`, but we will perform some simple checks with these columns later on.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>2.5 Tidy up DataFrame</h3>\n<p>We now carry so many columns inside the DataFrame, let's remove some intermediate columns to get more focus on our model. In particular we remove the following columns:</p>\n<ul>\n<li><code>words</code></li>\n<li><code>rating</code></li>\n</ul>\n<p>We keep the columns <code>review</code>, <code>name</code>, <code>sentiment</code> and <code>features</code>. For the model itself, we do not need <code>review</code> and <code>vwords</code>, but we will perform some simple checks with these columns later on.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924766_-1024415426","id":"20170129-044155_1317352834","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16720"},{"text":"// YOUR CODE HERE","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"name\treview\tsentiment\tvwords\tfeatures\nPlanetwise Wipe Pouch\tit came early and was not disappointed  i love planet wise bags and now my wipe holder  it keps my osocozy wipes moist and does not leak  highly recommend it \t1.0\tWrappedArray(came, early, not, disappointed, , love, planet, wise, bags, now, my, wipe, holder, , keps, my, osocozy, wipes, moist, does, not, leak, , highly, recommend)\t(29579,[0,1,10,33,63,83,99,224,244,345,422,437,454,657,716,1051,2045,3564,3970,5094],[3.0,2.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])\nAnnas Dream Full Quilt with 2 Shams\tVery soft and comfortable and warmer than it looks   fit the full size bed perfectly   would recommend to anyone looking for this type of quilt\t1.0\tWrappedArray(very, soft, comfortable, warmer, than, looks, , , fit, full, size, bed, perfectly, , , would, recommend, anyone, looking, type, quilt)\t(29579,[0,15,22,60,83,97,125,127,176,189,199,238,265,354,457,712,789,2669],[4.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tThis is a product well worth the purchase   I have not found anything else like this  and it is a positive  ingenious approach to losing the binky   What I love most about this product is how much ownership my daughter has in getting rid of the binky   She is so proud of herself  and loves her little fairy   I love the artwork  the chart in the back  and the clever approach of this tool \t1.0\tWrappedArray(product, well, worth, purchase, , , have, not, found, anything, else, like, , positive, , ingenious, approach, losing, binky, , , what, love, most, about, product, how, much, ownership, my, daughter, has, getting, rid, binky, , , she, so, proud, herself, , loves, her, little, fairy, , , love, artwork, , chart, back, , clever, approach, tool)\t(29579,[0,1,5,8,10,21,32,33,35,38,39,42,47,55,61,62,71,76,88,106,183,204,210,214,218,317,480,792,1644,1885,2099,2449,2975,3116,3523,3780,5119,6647,7068,7783,12259],[13.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0])\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tAll of my kids have cried non stop when I tried to ween them off their pacifier  until I found Thumbuddy To Love s Binky Fairy Puppet   It is an easy way to work with your kids to allow them to understand where their pacifier is going and help them part from it This is a must buy book  and a great gift for expecting parents    You will save them soo many headaches Thanks for this book   You all rock  \t1.0\tWrappedArray(all, my, kids, have, cried, non, stop, when, tried, ween, them, off, their, pacifier, , until, found, thumbuddy, love, s, binky, fairy, puppet, , , easy, way, work, with, your, kids, allow, them, understand, where, their, pacifier, going, help, them, part, from, must, buy, book, , great, gift, expecting, parents, , , , you, will, save, them, soo, many, headaches, thanks, book, , , you, all, rock)\t(29579,[0,1,3,5,9,11,16,17,29,31,33,37,45,46,74,80,101,118,126,163,179,190,197,209,210,227,256,276,287,324,348,501,608,737,758,835,864,874,902,933,1193,1363,2640,2975,3585,6363,6647,6676,10423],[9.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,2.0,4.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])\nStop Pacifier Sucking without tears with Thumbuddy To Love's Binky Fairy Puppet and Adorable Book\tWhen the Binky Fairy came to our house  we didn t have any special gift and book to help explain to her about how important it is to stop using a pacifier  This book does a great job to help prepare your child for the loss of their favorite item  The doll is adorable and we made lots of cute movies with the Binky Fairy telling our daughter about what happens when the Binky Fairy comes  I would highly recommend this product for any parent trying to break the pacifier or thumb sucking habit \t1.0\tWrappedArray(when, binky, fairy, came, our, house, , we, didn, t, have, any, special, gift, book, help, explain, her, about, how, important, stop, using, pacifier, , book, does, great, job, help, prepare, your, child, loss, their, favorite, item, , doll, adorable, we, made, lots, cute, movies, with, binky, fairy, telling, our, daughter, about, what, happens, when, binky, fairy, comes, , would, highly, recommend, product, any, parent, trying, break, pacifier, thumb, sucking, habit)\t(29579,[0,3,4,5,7,16,17,22,30,35,47,55,62,74,83,88,96,98,99,106,111,117,134,146,163,212,224,227,244,266,275,324,355,444,471,532,575,608,629,758,793,859,874,1205,1684,1714,1809,2975,2999,3429,3439,3543,3759,4069,6647,6955],[4.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,3.0,1.0,1.0,1.0,1.0,1.0,1.0,3.0,1.0])\nA Tale of Baby's Days with Peter Rabbit\tLovely book  it s bound tightly so you may not be able to add alot of photos cards aside from the designated spaces in the book  Shop around before you purchase  as it is currently listed at Barnes   Noble for 29 95 \t1.0\tWrappedArray(lovely, book, , s, bound, tightly, so, you, may, not, be, able, add, alot, photos, cards, aside, from, designated, spaces, book, , shop, around, before, you, purchase, , currently, listed, at, barnes, , , noble, 29, 95)\t(29579,[0,8,9,10,11,19,23,45,103,160,165,204,353,673,758,1208,1267,1545,1759,2051,2089,2157,2166,2191,2898,3787,3814,6435,7465,17121,18364],[5.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])\n"}]},"apps":[],"jobName":"paragraph_1520692924766_-1024415426","id":"20170129-044205_190711273","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16721"},{"text":"%md\n# Split Train Data / Validation Data\n\nNow let's do the usual split of our data into a training data set and a validation data set. Let's use 80% of all reviews for training and 20% for validation. Again the Spark DataFrame class offers a built in core method to perform the split.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Split Train Data / Validation Data</h1>\n<p>Now let's do the usual split of our data into a training data set and a validation data set. Let's use 80% of all reviews for training and 20% for validation. Again the Spark DataFrame class offers a built in core method to perform the split.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924767_-1024800175","id":"20170129-044218_1046591560","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16722"},{"text":"// YOUR CODE HERE\nval Array(trainingData, validationData) = ...\n\nprintln(s\"Training Data: ${trainingData.count()}\")\nprintln(s\"Validation Data: ${validationData.count()}\")","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\n\ntrainingData: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [name: string, review: string ... 2 more fields]\nvalidationData: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [name: string, review: string ... 2 more fields]\nTraining Data: 127435\nValidation Data: 31917\n"}]},"apps":[],"jobName":"paragraph_1520692924767_-1024800175","id":"20170129-044229_383362931","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16723"},{"text":"%md\n# Train Classifier\n\nThere are many different classification algorithms out there. We will use a LogisticRegression, of course a DecisionTreeClassifier could be another interesting option.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Train Classifier</h1>\n<p>There are many different classification algorithms out there. We will use a LogisticRegression, of course a DecisionTreeClassifier could be another interesting option.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924767_-1024800175","id":"20170129-044249_824800015","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16724"},{"text":"import org.apache.spark.ml.classification.LogisticRegression\n\n// YOUR CODE HERE\nval logisticRegression = ...\nval logisticModel = ...","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924767_-1024800175","id":"20170129-044302_1834217762","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16725"},{"text":"%md\n# Inspect Model\n\nThe LogisticRegressionModel also uses coefficients mapped to individual words. Let's have a look at them.\n\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Inspect Model</h1>\n<p>The LogisticRegressionModel also uses coefficients mapped to individual words. Let's have a look at them.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924767_-1024800175","id":"20170129-044314_1157019956","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16726"},{"text":"logisticModel.coefficients.toArray.take(20).foreach(println)","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924768_-1039035884","id":"20170129-044329_1169250287","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16727"},{"text":"%md\nLet's have a quick look about how many words have a positive weight and how many words have a negative weight.","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Let's have a quick look about how many words have a positive weight and how many words have a negative weight.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924768_-1039035884","id":"20170129-101914_1671147041","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16728"},{"text":"val coefficients = logisticModel.coefficients.toArray\nval numPositiveWeights = coefficients.count(_ > 0)\nval numNegativeWeights = coefficients.count(_ < 0)\n\nprintln(s\"Number positive weights $numPositiveWeights\")\nprintln(s\"Number negative weights $numNegativeWeights\")","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"coefficients: Array[Double] = Array(-0.017561437939671715, 0.295161682716593, 0.25021992730435205, 0.27733921214890384, 0.7107988554222496, 0.29477846424060833, -0.24605239408756102, -2.6303691532993927, 0.6363081830799967, 0.1592892960051039, -3.2170773563426023, -0.09822885696612584, -0.009343468661259131, 0.24760979861360516, 0.09872012291094587, -0.10360025738897112, 0.013817174757856548, 4.144903920455417, 1.1193100146109878, -0.32815204397575903, 0.7291297967074306, 0.9203937758281956, -0.794667308388645, -0.4282252876569603, -0.08061295048887308, -0.00676313387646479, -0.10343827564229385, 0.7125169451993731, -0.5386895485201948, -0.18634222624791286, 0.299533392201347, 0.24415239076737305, 1.2487307728678385, 5.546061728756544, 0.22028981833032443, 0.3299301473534606, -0.5563482...\nnumPositiveWeights: Int = 18132\n\nnumNegativeWeights: Int = 11137\nNumber positive weights 18132\nNumber negative weights 11137\n"}]},"apps":[],"jobName":"paragraph_1520692924768_-1039035884","id":"20170129-044553_1980650936","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16729"},{"text":"%md\n## Find Weights of some Words\n\nLet's check how coefficients look like for some clearly positive or negative words. This can be done by first looking up a specific word in the vocabulary of the CountVectorizerModel and then using that index to retrieve the weight in the LogisticRegressionModel we just trained. ","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Find Weights of some Words</h2>\n<p>Let's check how coefficients look like for some clearly positive or negative words. This can be done by first looking up a specific word in the vocabulary of the CountVectorizerModel and then using that index to retrieve the weight in the LogisticRegressionModel we just trained.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924768_-1039035884","id":"20170129-044409_841287254","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16730"},{"text":"def printWordWeight(word:String) = {\n    // YOUR CODE HERE\n    val index = ...\n    val weight = ...\n    println(s\"$word : $weight\")\n}\n    \n// YOUR CODE HERE    \n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nprintWordWeight: (word: String)Unit\ngood : 1.6318796942307014\ngreat : 4.144903920455417\nbest : 4.13280592328618\nugly : 2.788884753667541\nworst : -11.463664764540798\ncheap : -2.4951556769690697\n"}]},"apps":[],"jobName":"paragraph_1520692924768_-1039035884","id":"20170129-044413_362370312","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16731"},{"text":"%md\n## Find Extreme Words\n\nLet us try to find the most positive and most negative word according to the weights. This can be achieved using a argmin function to find the index and the vocabulary to map the index to the actual word. Unfortunately Scala does not provide an argmin or argmax function out of the box, so we need to create our own.","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Find Extreme Words</h2>\n<p>Let us try to find the most positive and most negative word according to the weights. This can be achieved using a argmin function to find the index and the vocabulary to map the index to the actual word. Unfortunately Scala does not provide an argmin or argmax function out of the box, so we need to create our own.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-044426_1753481605","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16732"},{"text":"import scala.collection.IndexedSeq\nimport scala.reflect.ClassTag\n\ndef idxmin[X  <% Ordered[X]: ClassTag](seq:IndexedSeq[X]) = {\n    seq.zipWithIndex.minBy(_._1)._2\n}\ndef idxmax[X  <% Ordered[X]: ClassTag](seq:IndexedSeq[X]) = {\n    seq.zipWithIndex.maxBy(_._1)._2\n}","dateUpdated":"2018-03-10T14:42:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-062847_749373872","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16733"},{"text":"%md\nWith argmin and argmax in place, we can now find the best and worst words","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>With argmin and argmax in place, we can now find the best and worst words</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-062010_1045358891","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16734"},{"text":"//val worstWordIndex = argmin(logisticModel.coefficients.toArray.indices, { n:Int => logisticModel.coefficients.toArray(n)} )\nval worstWordIndex = idxmin(logisticModel.coefficients.toArray)\nval worstWord = countVectorizerModel.vocabulary(worstWordIndex)\nval worstWeight = logisticModel.coefficients(worstWordIndex)\nprintln(s\"Worst word: $worstWord value $worstWeight\")\n\n//val bestWordIndex = argmax(logisticModel.coefficients.toArray.indices, { n:Int => logisticModel.coefficients.toArray(n)} )\nval bestWordIndex = idxmax(logisticModel.coefficients.toArray)\nval bestWord = countVectorizerModel.vocabulary(bestWordIndex)\nval bestWeight = logisticModel.coefficients(bestWordIndex)\nprintln(s\"Best word: $bestWord value $bestWeight\")","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-044442_1516043671","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16735"},{"text":"%md\n## Document Frequencies\n\nLet's have a look at document frequencies of words","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Document Frequencies</h2>\n<p>Let's have a look at document frequencies of words</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-064007_1643161693","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16736"},{"text":"import org.apache.spark.sql.functions.explode\n\nval doc_freq = features\n    .select(explode(features(\"vwords\")).alias(\"word\"), features(\"review\"))\n    .distinct()\n    .groupBy(col(\"word\")).count()\n\nz.show(doc_freq.orderBy(col(\"count\").desc).limit(10))","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"word","index":0,"aggr":"sum"}],"values":[{"name":"count","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"word","index":0,"aggr":"sum"},"yAxis":{"name":"count","index":1,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"word\tcount\n\t154689\nmy\t90945\nthat\t63055\nwith\t62874\nbut\t59980\nhave\t56813\nso\t55520\nt\t52971\nnot\t48931\ns\t46585\n"}]},"apps":[],"jobName":"paragraph_1520692924769_-1039420633","id":"20170129-044643_486786656","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16737"},{"text":"%md\n# Making Predictions\n\nThe primary idea is of course to make predictions of the sentiment using the learned model.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Making Predictions</h1>\n<p>The primary idea is of course to make predictions of the sentiment using the learned model.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924770_-1038266386","id":"20170129-044654_1617813197","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16738"},{"text":"// YOUR CODE HERE\nval pred = ...\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924770_-1038266386","id":"20170129-044704_1120754047","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16739"},{"text":"%md\n# Find the most Positive Review\n\nUsing the column rawPrediction, we can find the review which has the highest positive prediction.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Find the most Positive Review</h1>\n<p>Using the column rawPrediction, we can find the review which has the highest positive prediction.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924770_-1038266386","id":"20170129-044715_63959255","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16740"},{"text":"import org.apache.spark.ml.linalg.Vector\n// Extract one component from a Vectors\nval extractFromVector = udf{ (v:Vector, i:Integer) => v(i) }\n\n// YOUR CODE HERE\nval positives = ...\n\nz.show()\n    positives.select(col(\"name\"),col(\"review\"),col(\"sentiment\"),col(\"rawPrediction\"),col(\"prediction\")).limit(6)\n)    ","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[{"name":"review","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"},"yAxis":{"name":"review","index":1,"aggr":"sum"}}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924770_-1038266386","id":"20170129-044725_1084497064","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16741"},{"text":"%md\n# Evaluation of Prediction\n\nAgain we want to assess the performance of the prediction model. This can be done using the builtin class BinaryClassificationEvaluator.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Evaluation of Prediction</h1>\n<p>Again we want to assess the performance of the prediction model. This can be done using the builtin class BinaryClassificationEvaluator.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924770_-1038266386","id":"20170129-044740_1008352335","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16742"},{"text":"import org.apache.spark.ml.evaluation.BinaryClassificationEvaluator\n\n// YOUR CODE HERE\nval evaluator = ...\nprintln(evaluator.evaluate(pred))\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924771_-1038651135","id":"20170129-044751_2122449463","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16743"},{"text":"%md\n# Custom Evaluator\n\nWe want to use a different metric namely accuracy. Accuracy is defined as\n\nnumber_correct_predictions / total_number_predictions\n\nFirst let us directly calculate that metric\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Custom Evaluator</h1>\n<p>We want to use a different metric namely accuracy. Accuracy is defined as</p>\n<p>number_correct_predictions / total_number_predictions</p>\n<p>First let us directly calculate that metric</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924771_-1038651135","id":"20170129-044803_1942847520","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16744"},{"text":"// YOUR CODE HERE\nval numTotal = ...\nval numCorrect = ...\n\nval modelAccuracy = numCorrect.toFloat / numTotal.toFloat\n\nprintln(s\"Model Accuracy: $modelAccuracy\")","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924771_-1038651135","id":"20170129-044811_586986077","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16745"},{"text":"%md\n## Compare with Dummy Predictor\n\nIt is always interesting to see how a trivial prediction performs. The trivial predictor simply predicts the most common class for all objects. In this case this would be a positive review.\n","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Compare with Dummy Predictor</h2>\n<p>It is always interesting to see how a trivial prediction performs. The trivial predictor simply predicts the most common class for all objects. In this case this would be a positive review.</p>\n"}]},"apps":[],"jobName":"paragraph_1520692924771_-1038651135","id":"20170129-044827_1506840292","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16746"},{"text":"// YOUR CODE HERE\nval numTotal = ...\nval numPositive = ...\n\nval baselineAccuracy = numPositive.toFloat / numTotal\n\nprintln(s\"Baseline Accuracy: $baselineAccuracy\")","dateUpdated":"2018-03-10T14:42:04+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924789_-1034803646","id":"20170129-044840_1725986384","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16747"},{"text":"","dateUpdated":"2018-03-10T14:42:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520692924792_-1035957893","id":"20170129-080247_746419066","dateCreated":"2018-03-10T14:42:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:16748"}],"name":"Classification - Sentiument Analysis Skeleton","id":"2D8TE58QU","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}