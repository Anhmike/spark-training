{"paragraphs":[{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464516780374_-257295619","id":"20160529-031300_1474406012","dateCreated":"May 29, 2016 3:13:00 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4022","text":"%md\n# Weather Data Analytics\nThis notebook performs some basic weather data analytics using the PySpark RDD interface.","dateUpdated":"May 29, 2016 3:13:37 AM","dateFinished":"May 29, 2016 3:13:33 AM","dateStarted":"May 29, 2016 3:13:33 AM","result":{"code":"SUCCESS","type":"HTML","msg":"<h1>Weather Data Analytics</h1>\n<p>This notebook performs some basic weather data analytics using the PySpark RDD interface.</p>\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464516813620_-1275094378","id":"20160529-031333_1797730761","dateCreated":"May 29, 2016 3:13:33 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4039","dateUpdated":"May 29, 2016 3:32:28 AM","dateFinished":"May 29, 2016 3:32:28 AM","dateStarted":"May 29, 2016 3:32:28 AM","result":{"code":"SUCCESS","type":"TEXT","msg":""},"text":"%pyspark\n\ndef _get_float(str):\n    if len(str) == 0:\n        return None\n    try:\n        return float(str)\n    except ValueError:\n        return None\n\n\ndef extract_station(line):\n    raw_columns = line.split(',')\n    columns = [c.replace('\"','') for c in raw_columns]\n\n    usaf = columns[0]\n    wban = columns[1]\n    name = columns[2]\n    country = columns[3]\n    state = columns[4]\n    icao = columns[5]\n    latitude = _get_float(columns[6])\n    longitude = _get_float(columns[7])\n    elevation = _get_float(columns[8])\n    date_begin = columns[9]\n    date_end = columns[10]\n    return {'usaf':usaf, 'wban':wban, 'name':name, 'country':country, 'state':state, 'icao':icao, 'latitude':latitude, 'longitude':longitude, 'elevation':elevation, 'date_begin':date_begin, 'date_end':date_end }\n\n\ndef extract_weather(line):\n    date = line[15:23]\n    time = line[23:27]\n    usaf = line[4:10]\n    wban = line[10:15]\n    airTemperatureQuality = line[92] == '1'\n    airTemperature = float(line[87:92]) / 10\n    windSpeedQuality = line[69] == '1'\n    windSpeed = float(line[65:69]) / 10\n    return {'date':date, 'time':time, 'usaf':usaf, 'wban':wban, 'airTemperatureQuality':airTemperatureQuality, 'airTemperature':airTemperature, 'windSpeedQuality':windSpeedQuality, 'windSpeed':windSpeed }\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464516859853_1354725651","id":"20160529-031419_1558751807","dateCreated":"May 29, 2016 3:14:19 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4061","dateUpdated":"May 29, 2016 3:53:18 AM","dateFinished":"May 29, 2016 3:53:18 AM","dateStarted":"May 29, 2016 3:53:18 AM","result":{"code":"SUCCESS","type":"TEXT","msg":""},"text":"%pyspark\n\ndef nullsafe_binop(a, b, op):\n    if a is None:\n        return b\n    if b is None:\n        return a\n    return op(a,b)\n    \ndef nullsafe_min(a, b):\n    return nullsafe_binop(a, b, min)\n\ndef nullsafe_max(a, b):\n    return nullsafe_binop(a, b, max)\n\n\ndef reduce_wmm(wmm, data):\n    \"\"\"\n    Used for merging in a new weather data set into an existing WeatherMinMax object. The incoming\n    objects will not be modified, instead a new object will be returned.\n    :param wmm: WeatherMinMax object\n    :param data: WeatherData object\n    :returns: A new WeatherMinMax object\n    \"\"\"\n    if data['airTemperatureQuality']:\n        minTemperature = nullsafe_min(wmm['minTemperature'], data['airTemperature'])\n        maxTemperature = nullsafe_max(wmm['maxTemperature'], data['airTemperature'])\n    else:\n        minTemperature = wmm['minTemperature']\n        maxTemperature = wmm['maxTemperature']\n\n    if data['windSpeedQuality']:\n        minWindSpeed = nullsafe_min(wmm['minWindSpeed'], data['windSpeed'])\n        maxWindSpeed = nullsafe_max(wmm['maxWindSpeed'], data['windSpeed'])\n    else:\n        minWindSpeed = wmm['minWindSpeed']\n        maxWindSpeed = wmm['maxWindSpeed']\n\n    return { 'minTemperature':minTemperature, 'maxTemperature':maxTemperature, 'minWindSpeed':minWindSpeed, 'maxWindSpeed':maxWindSpeed }\n\n\ndef combine_wmm(left, right):\n    \"\"\"\n    Used for combining two WeatherMinMax objects into a new WeatherMinMax object\n    :param self: First WeatherMinMax object\n    :param other: Second WeatherMinMax object\n    :returns: A new WeatherMinMax object\n    \"\"\"\n    minTemperature = nullsafe_min(left['minTemperature'], right['minTemperature'])\n    maxTemperature = nullsafe_max(left['maxTemperature'], right['maxTemperature'])\n    minWindSpeed = nullsafe_min(left['minWindSpeed'], right['minWindSpeed'])\n    maxWindSpeed = nullsafe_max(left['maxWindSpeed'], right['maxWindSpeed'])\n\n    return { 'minTemperature':minTemperature, 'maxTemperature':maxTemperature, 'minWindSpeed':minWindSpeed, 'maxWindSpeed':maxWindSpeed }\n\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464517120667_-392066648","id":"20160529-031840_1032043567","dateCreated":"May 29, 2016 3:18:40 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4079","dateUpdated":"May 29, 2016 3:52:28 AM","dateFinished":"May 29, 2016 3:52:29 AM","dateStarted":"May 29, 2016 3:52:28 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[{'date_begin': u'BEGIN', 'name': u'STATION NAME', 'country': u'CTRY', 'date_end': u'END', 'usaf': u'USAF', 'longitude': None, 'icao': u'ICAO', 'state': u'STATE', 'wban': u'WBAN', 'latitude': None, 'elevation': None}, {'date_begin': u'20120127', 'name': u'CWOS 07005', 'country': u'', 'date_end': u'20120127', 'usaf': u'007005', 'longitude': None, 'icao': u'', 'state': u'', 'wban': u'99999', 'latitude': None, 'elevation': None}, {'date_begin': u'20111025', 'name': u'CWOS 07011', 'country': u'', 'date_end': u'20121129', 'usaf': u'007011', 'longitude': None, 'icao': u'', 'state': u'', 'wban': u'99999', 'latitude': None, 'elevation': None}, {'date_begin': u'20110309', 'name': u'WXPOD 7018', 'country': u'', 'date_end': u'20130730', 'usaf': u'007018', 'longitude': 0.0, 'icao': u'', 'state': u'', 'wban': u'99999', 'latitude': 0.0, 'elevation': 7018.0}, {'date_begin': u'20120127', 'name': u'CWOS 07025', 'country': u'', 'date_end': u'20120127', 'usaf': u'007025', 'longitude': None, 'icao': u'', 'state': u'', 'wban': u'99999', 'latitude': None, 'elevation': None}]\n"},"text":"%pyspark\nstations = sc.textFile('/user/cloudera/data/weather/isd-history.csv').map(lambda line: extract_station(line))\nprint stations.take(5)\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464517215369_735802589","id":"20160529-032015_880586807","dateCreated":"May 29, 2016 3:20:15 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4097","dateUpdated":"May 29, 2016 3:45:28 AM","dateFinished":"May 29, 2016 3:45:28 AM","dateStarted":"May 29, 2016 3:45:28 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[{'airTemperature': -13.6, 'windSpeedQuality': True, 'usaf': u'010060', 'windSpeed': 3.0, 'wban': u'99999', 'time': u'0100', 'date': u'20140101', 'airTemperatureQuality': True}, {'airTemperature': -14.199999999999999, 'windSpeedQuality': True, 'usaf': u'010060', 'windSpeed': 2.0, 'wban': u'99999', 'time': u'0200', 'date': u'20140101', 'airTemperatureQuality': True}, {'airTemperature': -10.699999999999999, 'windSpeedQuality': True, 'usaf': u'010060', 'windSpeed': 4.0, 'wban': u'99999', 'time': u'0400', 'date': u'20140101', 'airTemperatureQuality': True}, {'airTemperature': -11.199999999999999, 'windSpeedQuality': True, 'usaf': u'010060', 'windSpeed': 3.0, 'wban': u'99999', 'time': u'0500', 'date': u'20140101', 'airTemperatureQuality': True}, {'airTemperature': -10.0, 'windSpeedQuality': True, 'usaf': u'010060', 'windSpeed': 5.0, 'wban': u'99999', 'time': u'0600', 'date': u'20140101', 'airTemperatureQuality': True}]\n"},"text":"%pyspark\nweather = sc.textFile('/user/cloudera/data/weather/2014').map(lambda line: extract_weather(line))\nprint weather.take(5)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464518172380_-313094600","id":"20160529-033612_19457069","dateCreated":"May 29, 2016 3:36:12 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4151","dateUpdated":"May 29, 2016 3:47:00 AM","dateFinished":"May 29, 2016 3:48:25 AM","dateStarted":"May 29, 2016 3:47:00 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[(u'71060099999', ({'airTemperature': -6.5999999999999996, 'windSpeedQuality': True, 'usaf': u'710600', 'windSpeed': 1.5, 'wban': u'99999', 'time': u'0000', 'date': u'20140101', 'airTemperatureQuality': True}, {'date_begin': u'19840101', 'name': u'NORDEGG CS  ALTA', 'country': u'CA', 'date_end': u'20151121', 'usaf': u'710600', 'longitude': -116.06699999999999, 'icao': u'CXND', 'state': u'', 'wban': u'99999', 'latitude': 52.466999999999999, 'elevation': 1362.0})), (u'71060099999', ({'airTemperature': -7.5999999999999996, 'windSpeedQuality': True, 'usaf': u'710600', 'windSpeed': 1.5, 'wban': u'99999', 'time': u'0000', 'date': u'20140101', 'airTemperatureQuality': True}, {'date_begin': u'19840101', 'name': u'NORDEGG CS  ALTA', 'country': u'CA', 'date_end': u'20151121', 'usaf': u'710600', 'longitude': -116.06699999999999, 'icao': u'CXND', 'state': u'', 'wban': u'99999', 'latitude': 52.466999999999999, 'elevation': 1362.0})), (u'71060099999', ({'airTemperature': -7.0, 'windSpeedQuality': True, 'usaf': u'710600', 'windSpeed': 2.1000000000000001, 'wban': u'99999', 'time': u'0100', 'date': u'20140101', 'airTemperatureQuality': True}, {'date_begin': u'19840101', 'name': u'NORDEGG CS  ALTA', 'country': u'CA', 'date_end': u'20151121', 'usaf': u'710600', 'longitude': -116.06699999999999, 'icao': u'CXND', 'state': u'', 'wban': u'99999', 'latitude': 52.466999999999999, 'elevation': 1362.0})), (u'71060099999', ({'airTemperature': -5.2999999999999998, 'windSpeedQuality': True, 'usaf': u'710600', 'windSpeed': 1.0, 'wban': u'99999', 'time': u'0200', 'date': u'20140101', 'airTemperatureQuality': True}, {'date_begin': u'19840101', 'name': u'NORDEGG CS  ALTA', 'country': u'CA', 'date_end': u'20151121', 'usaf': u'710600', 'longitude': -116.06699999999999, 'icao': u'CXND', 'state': u'', 'wban': u'99999', 'latitude': 52.466999999999999, 'elevation': 1362.0})), (u'71060099999', ({'airTemperature': -5.2000000000000002, 'windSpeedQuality': True, 'usaf': u'710600', 'windSpeed': 1.0, 'wban': u'99999', 'time': u'0300', 'date': u'20140101', 'airTemperatureQuality': True}, {'date_begin': u'19840101', 'name': u'NORDEGG CS  ALTA', 'country': u'CA', 'date_end': u'20151121', 'usaf': u'710600', 'longitude': -116.06699999999999, 'icao': u'CXND', 'state': u'', 'wban': u'99999', 'latitude': 52.466999999999999, 'elevation': 1362.0}))]\n"},"text":"%pyspark\nstation_index = stations.keyBy(lambda data: data['usaf'] + data['wban'])\nweather_index = weather.keyBy(lambda data: data['usaf'] + data['wban'])\njoined_weather = weather_index.join(station_index)\nprint joined_weather.take(5)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464518748080_179627534","id":"20160529-034548_663039320","dateCreated":"May 29, 2016 3:45:48 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4185","dateUpdated":"May 29, 2016 3:53:25 AM","dateFinished":"May 29, 2016 3:53:52 AM","dateStarted":"May 29, 2016 3:53:25 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[((u'EZ', u'2014'), {'maxWindSpeed': 16.5, 'maxTemperature': 33.0, 'minWindSpeed': 0.0, 'minTemperature': -15.0}), ((u'UK', u'2014'), {'maxWindSpeed': 20.600000000000001, 'maxTemperature': 30.399999999999999, 'minWindSpeed': 0.0, 'minTemperature': -6.0}), ((u'SF', u'2014'), {'maxWindSpeed': 13.4, 'maxTemperature': 37.399999999999999, 'minWindSpeed': 0.0, 'minTemperature': 0.90000000000000002}), ((u'SC', u'2014'), {'maxWindSpeed': 30.399999999999999, 'maxTemperature': 32.0, 'minWindSpeed': 0.0, 'minTemperature': 20.0}), ((u'CH', u'2014'), {'maxWindSpeed': 15.0, 'maxTemperature': 34.0, 'minWindSpeed': 0.0, 'minTemperature': 11.0})]\n"},"text":"%pyspark\ndef extract_country_year_weather(data):\n    return ((data[1][1]['country'], data[1][0]['date'][0:4]), data[1][0])\n\nweather_per_country_and_year = joined_weather.map(extract_country_year_weather)\n\n# Aggregate min/max information per year and country\nzero = { 'minTemperature':None, 'maxTemperature':None, 'minWindSpeed':None, 'maxWindSpeed':None }\nweather_minmax = weather_per_country_and_year.aggregateByKey(zero,reduce_wmm, combine_wmm)\n\nprint weather_minmax.take(5)\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464519003240_-1658562625","id":"20160529-035003_1164909547","dateCreated":"May 29, 2016 3:50:03 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4214","dateUpdated":"May 29, 2016 3:54:42 AM","dateFinished":"May 29, 2016 3:54:46 AM","dateStarted":"May 29, 2016 3:54:42 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"EZ,2014,-15.000000,33.000000,0.000000,16.500000\nUK,2014,-6.000000,30.400000,0.000000,20.600000\nSF,2014,0.900000,37.400000,0.000000,13.400000\nSC,2014,20.000000,32.000000,0.000000,30.400000\nCH,2014,11.000000,34.000000,0.000000,15.000000\nSW,2014,-34.500000,28.900000,1.000000,16.000000\nIT,2014,-6.800000,24.000000,0.000000,20.600000\nFI,2014,-28.600000,30.300000,0.000000,18.000000\nUS,2014,-37.200000,41.200000,0.000000,31.000000\nAS,2014,0.900000,45.600000,0.000000,14.400000\nJA,2014,-0.500000,33.900000,0.000000,19.600000\nPO,2014,-1.000000,32.000000,0.000000,15.400000\nGK,2014,2.000000,24.000000,0.000000,21.100000\nMY,2014,19.000000,36.000000,0.000000,9.800000\nAU,2014,-11.000000,34.000000,0.000000,16.500000\nDA,2014,-9.000000,30.200000,0.000000,17.000000\nGM,2014,-9.000000,31.000000,0.000000,13.400000\nFR,2014,-9.000000,36.100000,0.000000,16.500000\nPL,2014,-15.000000,32.000000,0.000000,14.900000\nRS,2014,-28.900000,30.500000,0.000000,11.000000\nLU,2014,-10.000000,32.100000,0.000000,13.400000\nBE,2014,-7.000000,33.100000,0.000000,16.000000\nIC,2014,-7.000000,18.000000,0.000000,29.300000\nCA,2014,-43.600000,35.900000,0.000000,26.800000\nNO,2014,-35.700000,32.000000,0.000000,35.500000\nAM,2014,-19.000000,39.000000,0.000000,16.000000\nNL,2014,-9.000000,35.000000,0.000000,27.300000\n"},"text":"%pyspark\ndef format_result(row):\n    (k,v) = row\n    country = k[0]\n    year = k[1]\n    minT = v['minTemperature'] or 0.0\n    maxT = v['maxTemperature'] or 0.0\n    minW = v['minWindSpeed'] or 0.0\n    maxW = v['maxWindSpeed'] or 0.0\n    line = \"%s,%s,%f,%f,%f,%f\" % (country, year, minT, maxT, minW, maxW)\n    return line.encode('utf-8')\n\nresult = weather_minmax.map(format_result).collect()\n\nfor l in result:\n    print l\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1464519265257_905387077","id":"20160529-035425_1577883334","dateCreated":"May 29, 2016 3:54:25 AM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4251"}],"name":"PySpark Weather Analysis","id":"2BN5S5X15","angularObjects":{"2BKGW8Q6E":[],"2BP2JWUVF":[],"2BM4Z6DBF":[],"2BJUEKW1N":[],"2BNG99EDF":[],"2BM6V6VQG":[],"2BKHCUTH5":[],"2BJGUFRFB":[],"2BM4XH3S9":[],"2BKRDB8F5":[],"2BJDKPSX9":[],"2BN3H3JME":[],"2BMJC3KG9":[],"2BM79W2EN":[]},"config":{"looknfeel":"default"},"info":{}}